<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¤ëª…í•˜ëŠ” ê¸€ ìš”ì•½í•˜ê¸°: êµ¬ì¡° í™œìš©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #1d4ed8;
            --bg-color: #f0f9ff;
            --card-bg: #ffffff;
            --text-color: #1e293b;
            --muted-color: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --radius-lg: 20px;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            padding: 30px;
            min-height: 80vh;
            position: relative;
        }

        /* Util */
        .text-center {
            text-align: center;
        }

        .mb-4 {
            margin-bottom: 1.5rem;
        }

        .premium-shadow {
            box-shadow: 0 20px 50px rgba(59, 130, 246, 0.15);
        }

        .mb-6 {
            margin-bottom: 2.5rem;
        }

        .report-export-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 40px;
            padding-bottom: 40px;
        }

        .mt-6 {
            margin-top: 2.5rem;
        }

        /* UI Elements */
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: white;
            font-weight: bold;
        }

        .badge.beginner {
            background: #4ade80;
        }

        .badge.intermediate {
            background: #f59e0b;
        }

        .badge.advanced {
            background: #ef4444;
        }

        .game-stats {
            display: flex;
            gap: 20px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .avatar {
            font-size: 2.5rem;
            display: inline-block;
        }

        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        /* Selection Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .selection-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .selection-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.1);
        }

        .card-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        /* Navigation */
        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .back-btn {
            background: #f1f5f9;
            color: #64748b;
            border: 1px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .back-btn:hover {
            background: #e2e8f0;
            color: #475569;
        }

        /* Steps (Side Tabs - ë ì§€) */
        .game-layout-container {
            display: flex;
            gap: 0;
            position: relative;
        }

        .side-tab-container {
            width: 40px;
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-top: 10px;
        }

        .side-tab {
            width: 40px;
            padding: 15px 5px;
            background: #e2e8f0;
            color: #64748b;
            writing-mode: vertical-rl;
            text-orientation: upright;
            font-size: 0.8rem;
            font-weight: bold;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #cbd5e1;
            border-left: none;
            margin-bottom: 5px;
            opacity: 0.6;
        }

        .side-tab:hover {
            opacity: 1;
            background: #cbd5e1;
            width: 45px;
        }

        .side-tab.active {
            background: var(--primary);
            color: white;
            opacity: 1;
            width: 50px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 2;
        }

        /* Continuous Highlighter Styles */
        .hl-para {
            transition: background 0.3s;
            padding: 2px 0;
            border-radius: 4px;
            cursor: pointer;
        }

        .hl-para:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .hl-p1 {
            background-color: rgba(254, 240, 138, 0.7);
        }

        /* Yellow */
        .hl-p2 {
            background-color: rgba(187, 247, 208, 0.7);
        }

        /* Green */
        .hl-p3 {
            background-color: rgba(191, 219, 254, 0.7);
        }

        /* Blue */
        .hl-p4 {
            background-color: rgba(254, 202, 202, 0.7);
        }

        /* Red */
        .hl-p5 {
            background-color: rgba(233, 213, 255, 0.7);
        }

        /* Purple */
        .hl-p6 {
            background-color: rgba(255, 237, 213, 0.7);
        }

        /* Orange */

        /* Steps (Legacy Indicator Hidden if needed) */
        .step-indicator {
            display: none;
            /* Hide if using side tabs */
        }

        /* Split View & Panel */
        .split-view {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
        }

        .text-panel {
            background: #f8fafc;
            padding: 20px 25px;
            border-radius: 12px;
            line-height: 1.8;
            font-size: 1.1rem;
            border: 1px solid #e2e8f0;
            white-space: pre-wrap;
            max-height: 40vh;
            overflow-y: auto;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.02);
        }

        .text-panel p {
            margin-bottom: 0.8rem;
            text-align: justify;
        }

        .activity-panel {
            background: white;
            padding: 25px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            min-height: 400px;
        }

        /* Numbering Step */
        .para-number {
            display: inline-block;
            width: 28px;
            height: 28px;
            background: #e2e8f0;
            color: #64748b;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-right: 12px;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .para-number.active {
            background: var(--primary);
            color: white;
        }

        .paragraph-block {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .paragraph-block:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .paragraph-block.numbered {
            border-color: #bfdbfe;
            background: #eff6ff;
        }

        /* Interactive Elements */
        .splitter {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            border-radius: 50%;
            background: #e2e8f0;
            margin: 0 5px;
            cursor: pointer;
            color: #64748b;
            vertical-align: middle;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .splitter:hover {
            background: #cbd5e1;
        }

        .splitter.active {
            background: var(--primary);
            color: white;
            width: auto;
            padding: 0 10px;
            border-radius: 15px;
        }

        .sentence {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
        }

        .sentence:hover {
            background: #eff6ff;
        }

        .sentence.selected {
            background: #bfdbfe;
            border-bottom: 2px solid var(--primary);
        }

        .option-grid {
            display: grid;
            gap: 10px;
        }

        .option-btn {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .option-btn:hover {
            border-color: var(--primary);
            background: #f0f9ff;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            margin: 10px 0;
        }

        button.action-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
        }

        button.action-btn.secondary {
            background: #94a3b8;
            margin-top: 10px;
        }

        .feedback-msg {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .feedback-msg.good {
            background: #dcfce7;
            color: #166534;
        }

        .feedback-msg.bad {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Step 5 Diagram */
        .diagram-area {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .structure-box {
            background: white;
            border: 2px solid #cbd5e1;
            padding: 12px 10px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.95rem;
            width: 100%;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: keep-all;
            line-height: 1.4;
            box-sizing: border-box;
        }

        .structure-box.main {
            border-color: var(--primary);
            background: #eff6ff;
        }

        .structure-row {
            display: flex;
            gap: 15px;
            width: 100%;
            justify-content: center;
            align-items: stretch;
            flex-wrap: wrap;
        }

        .structure-row.spread {
            justify-content: space-around;
        }

        .arrow-row {
            color: #94a3b8;
            font-size: 1.2rem;
        }

        /* Diagram Builder UI */
        .diagram-builder-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .builder-btn {
            padding: 8px 12px;
            border: 1px solid #cbd5e1;
            background: white;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .builder-btn:hover {
            background: #f1f5f9;
        }

        .builder-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .structure-box-wrapper {
            position: relative;
            width: 100%;
        }

        .remove-box-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .add-box-btn {
            margin-top: 5px;
            padding: 5px 10px;
            background: #f1f5f9;
            border: 1px dashed #cbd5e1;
            border-radius: 6px;
            color: #64748b;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-box-btn:hover {
            background: #e2e8f0;
            color: var(--primary);
            border-color: var(--primary);
        }

        /* Matching Quiz Grid */
        /* Sequential Click Matching Styles */
        .matching-container {
            display: flex;
            gap: 15px;
            justify-content: space-between;
            margin-bottom: 25px;
            position: relative;
        }

        /* Drag-Table Quiz Styles */
        .drag-quiz-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .drag-quiz-table th,
        .drag-quiz-table td {
            border: 1px solid #e2e8f0;
            padding: 15px;
            text-align: center;
        }

        .drag-quiz-table th {
            background: #f8fafc;
            color: #475569;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .quiz-drop-zone {
            min-height: 80px;
            background: #fdfdfd;
            border: 2px dashed #cbd5e1;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 5px;
        }

        .quiz-drop-zone.hover {
            background: #f0f9ff;
            border-color: #3b82f6;
        }

        .quiz-drop-zone.filled {
            border-style: solid;
            background: white;
            border-color: #3b82f6;
        }

        .draggable-pool {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 20px;
            background: #f1f5f9;
            border-radius: 12px;
            margin-top: 20px;
            min-height: 100px;
            justify-content: center;
        }

        .draggable-item {
            padding: 10px 15px;
            background: white;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            cursor: grab;
            user-select: none;
            font-size: 0.9rem;
            color: #1e40af;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.1);
        }

        .draggable-item:active {
            cursor: grabbing;
        }

        .draggable-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .matching-img-small {
            max-width: 100%;
            max-height: 80px;
            object-fit: contain;
        }

        .matching-item {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            height: 110px;
            /* Fixed height for row alignment */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .matching-item:hover {
            border-color: var(--primary-light);
            background: #f8fafc;
            transform: translateY(-2px);
        }

        .matching-item.selected {
            border-color: var(--primary);
            background: #eff6ff;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            transform: scale(1.02);
            z-index: 10;
        }

        .matching-item:active {
            transform: scale(0.98);
            background: #f1f5f9;
        }

        /* Canvas Interaction Styles */
        .canvas-token {
            display: inline;
            padding: 0;
            margin: 0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .canvas-token:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .canvas-token:active {
            transform: scale(0.95);
            background: #e2e8f0;
        }

        .canvas-token.topic {
            display: inline-block;
            background: transparent;
            padding: 1px 0;
            border-bottom: 2px solid var(--primary);
            font-weight: bold;
        }

        .canvas-token.marker {
            display: inline-block;
            border: 2px dashed #fb923c;
            /* Orange Dashed */
            border-radius: 6px;
            padding: 0px 4px;
        }

        .canvas-sentence {
            display: inline;
            padding: 0;
            margin: 0;
            position: relative;
        }

        .canvas-sentence:hover {
            background: #eff6ff;
            border-color: #bfdbfe;
        }

        .canvas-sentence:active {
            transform: scale(0.99);
            background: #dbeafe;
        }

        .canvas-sentence.selected {
            background: #d1fae5;
            border-bottom: 2px solid #10b981;
        }


        .matching-item.matched.group-0 {
            border-color: #3b82f6 !important;
            /* Blue */
            background: #eff6ff !important;
        }

        .matching-item.matched.group-1 {
            border-color: #10b981 !important;
            /* Green */
            background: #ecfdf5 !important;
        }

        .matching-item.matched.group-2 {
            border-color: #8b5cf6 !important;
            /* Purple */
            background: #f5f3ff !important;
        }

        .matching-item.matched {
            cursor: default;
            opacity: 1;
            /* Keep fully visible for color distinction */
            pointer-events: none;
        }

        .matching-item.matched::after {
            content: 'âœ…';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 1.2rem;
            background: white;
            border-radius: 50%;
            line-height: 1;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Image Zoom Styles */
        .matching-img-container {
            position: relative;
            cursor: default;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        .zoom-icon-btn {
            position: absolute;
            bottom: -5px;
            right: -5px;
            font-size: 1rem;
            background: white;
            border-radius: 50%;
            padding: 4px;
            line-height: 1;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
            z-index: 20;
        }

        .zoom-icon-btn:hover {
            transform: scale(1.2);
            background: #f1f5f9;
        }

        .zoom-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            cursor: zoom-out;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .zoom-modal img {
            max-width: 90%;
            max-height: 90%;
            transform: scale(2.5);
            /* Boosted zoom */
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .report-paper {
            background: white;
            padding: 60px;
            border-radius: 4px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            border: 20px solid #f8fafc;
            /* Wide outer frame */
            outline: 2px solid #e2e8f0;
            /* Thin inner line */
            outline-offset: -12px;
            background-image:
                radial-gradient(circle at 100% 100%, rgba(59, 130, 246, 0.03) 0%, transparent 20%),
                radial-gradient(circle at 0% 0%, rgba(59, 130, 246, 0.03) 0%, transparent 20%);
        }

        /* Decorative Corners */
        .report-paper::after {
            content: 'âœ¨';
            position: absolute;
            bottom: 25px;
            right: 25px;
            font-size: 1.5rem;
            opacity: 0.3;
        }

        .report-corner {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 3px solid #cbd5e1;
            pointer-events: none;
        }

        .corner-tl {
            top: 25px;
            left: 25px;
            border-right: none;
            border-bottom: none;
        }

        .corner-tr {
            top: 25px;
            right: 25px;
            border-left: none;
            border-bottom: none;
        }

        .corner-bl {
            bottom: 25px;
            left: 25px;
            border-right: none;
            border-top: none;
        }

        .corner-br {
            bottom: 25px;
            right: 25px;
            border-left: none;
            border-top: none;
        }

        .report-paper .seal {
            position: absolute;
            bottom: 60px;
            right: 60px;
            width: 100px;
            height: 100px;
            border: 4px double rgba(59, 130, 246, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: bold;
            color: rgba(59, 130, 246, 0.4);
            text-align: center;
            transform: rotate(-15deg);
            pointer-events: none;
            border: 5px double rgba(59, 130, 246, 0.15);
        }

        .report-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .loading-animation {
            width: 200px;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }

        .loading-bar {
            width: 0%;
            height: 100%;
            background: var(--primary);
            transition: width 0.1s linear;
        }

        .loading-text {
            font-size: 1.2rem;
            color: var(--primary-dark);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .loading-subtext {
            font-size: 0.9rem;
            color: #64748b;
        }

        .report-header h2 {
            font-family: 'Inter', sans-serif;
            letter-spacing: -1px;
            border-bottom: 4px solid var(--primary);
            display: inline-block;
            padding-bottom: 5px;
        }

        .report-section h4 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .report-section h4::before {
            content: '';
            width: 4px;
            height: 1.2rem;
            background: var(--primary);
            border-radius: 2px;
        }

        .feedback-msg.info {
            background: #f0f9ff;
            color: #0369a1;
            border-color: #e0f2fe;
        }

        .quiz-short-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        /* Comparison Chart Styles (Replaces Venn) */
        .comp-chart-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 100%;
            margin: 20px auto;
            min-height: 450px;
        }

        .comp-column {
            display: flex;
            flex-direction: column;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #e2e8f0;
            background: #fff;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .comp-column:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }

        .comp-column-header {
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 0.95rem;
            color: #1e293b;
            border-bottom: 2px solid rgba(0, 0, 0, 0.05);
        }

        .comp-column.left .comp-column-header {
            background: #6366f1;
        }

        .comp-column.center .comp-column-header {
            background: #8b5cf6;
        }

        .comp-column.right .comp-column-header {
            background: #ec4899;
        }

        .comp-column.left {
            background: rgba(99, 102, 241, 0.03);
            border-color: #c7d2fe;
        }

        .comp-column.center {
            background: rgba(139, 92, 246, 0.03);
            border-color: #ddd6fe;
        }

        .comp-column.right {
            background: rgba(236, 72, 153, 0.03);
            border-color: #fbcfe8;
        }

        .comp-block-list {
            padding: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
            max-height: 380px;
        }

        .venn-input {
            width: 80%;
            min-height: 100px;
            background: transparent;
            border: none;
            outline: none;
            font-size: 0.95rem;
            line-height: 1.5;
            text-align: center;
            overflow-y: auto;
            word-break: break-all;
        }

        .venn-center .venn-input {
            min-height: 80px;
        }

        .reference-box:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .reference-box strong {
            display: block;
            margin-bottom: 8px;
            color: #854d0e;
        }

        #ref-keyword,
        #ref-sentences {
            color: #713f12;
            padding-left: 10px;
        }

        @media (max-width: 768px) {
            .split-view {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 15px;
            }
        }

        /* Print Styles for PDF/Report Saving */
        @media print {
            body {
                background: white;
                padding: 0;
                margin: 0;
            }

            .container {
                width: 100%;
                max-width: none;
                border: none;
                padding: 0;
                margin: 0;
                box-shadow: none;
            }

            header,
            .progress-container,
            .header-row,
            .text-center.mt-6,
            .back-btn,
            #game-stats {
                display: none !important;
            }

            .screen {
                padding: 0;
                margin: 0;
            }

            .report-paper {
                box-shadow: none;
                border: 1px solid #eee;
                padding: 0;
                margin: 0;
                width: 100%;
            }

            .report-section {
                page-break-inside: avoid;
            }
        }

        .recommend-card {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .recommend-card:hover {
            transform: scale(1.02);
            background: #dcfce7;
        }

        .recommend-icon {
            font-size: 2rem;
        }

        /* Global Navigation Tabs (ë ì§€) Styles */
        .global-nav {
            position: absolute;
            left: 100%;
            top: 60px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
        }

        .global-tab {
            width: 45px;
            height: 140px;
            background: white;
            border: 2px solid #e2e8f0;
            border-left: none;
            border-radius: 0 12px 12px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.08);
            color: #64748b;
            font-weight: bold;
            font-size: 0.9rem;
            text-align: center;
            padding: 10px 5px;
            writing-mode: vertical-rl;
            text-orientation: upright;
            letter-spacing: 3px;
        }

        .global-tab:hover {
            width: 60px;
            padding-left: 20px;
            box-shadow: 6px 0 20px rgba(0, 0, 0, 0.12);
        }

        /* kitsch colors for global tabs */
        .global-tab.quiz-tab {
            border-color: #22c55e;
            color: #15803d;
            background: #f0fdf4;
        }

        .global-tab.quiz-tab:hover {
            background: #22c55e;
            color: white;
        }

        .global-tab.level-tab {
            border-color: #3b82f6;
            color: #1d4ed8;
            background: #eff6ff;
        }

        .global-tab.level-tab:hover {
            background: #3b82f6;
            color: white;
        }

        .global-tab.report-tab {
            border-color: #f59e0b;
            color: #b45309;
            background: #fffbeb;
        }

        .global-tab.report-tab:hover {
            background: #f59e0b;
            color: white;
        }

        .global-tab .tab-icon {
            font-size: 1.3rem;
            margin-bottom: 8px;
            writing-mode: horizontal-tb;
        }

        @media (max-width: 1200px) {
            .global-nav {
                display: none;
            }
        }

        /* Print Optimization */
        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                max-width: 100%;
                border: none;
                box-shadow: none;
                margin: 0;
                padding: 0;
            }

            header,
            .no-print,
            .side-nav,
            #global-progress,
            .back-btn,
            #avatar-display {
                display: none !important;
            }

            .screen {
                display: none !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            #screen-report {
                display: block !important;
            }

            .report-paper {
                box-shadow: none !important;
                border: 1px solid #e2e8f0 !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 30px !important;
            }

            .action-btn,
            .text-center.mt-6.no-print {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div style="display:flex; align-items:center; gap:10px;">
                <h1>ğŸ“ ì„¤ëª…í•˜ëŠ” ê¸€ ìš”ì•½í•˜ê¸°</h1>
                <span id="level-badge" class="badge" style="display:none;"></span>
            </div>

            <div class="game-stats" id="game-stats" style="display:none;">
                <div class="stat-item">
                    <span class="avatar" id="avatar-display">ğŸ˜</span>
                </div>
                <div class="stat-item">
                    <span style="font-size:0.9rem; color:var(--muted-color);">ì ìˆ˜</span>
                    <strong id="score-display" style="font-size:1.2rem; color:var(--primary);">0</strong>
                </div>
            </div>
        </header>

        <!-- Global Navigation Sidebar (Attached to Container Right) -->
        <div class="global-nav no-print">
            <div class="global-tab quiz-tab" onclick="showScreen('screen-quiz')">
                <span class="tab-icon">ğŸ</span>ë³µìŠµí€´ì¦ˆ
            </div>
            <div class="global-tab level-tab" onclick="showScreen('screen-level')">
                <span class="tab-icon">ğŸš€</span>í™œë™ì„ íƒ
            </div>
            <div class="global-tab report-tab" onclick="showScreen('screen-history')">
                <span class="tab-icon">ğŸ“œ</span>ë‚´ ë³´ê³ ì„œ
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container" id="global-progress" style="display:none; margin-bottom:20px;">
            <div class="progress-bar" id="progress-bar"
                style="background:#e2e8f0; height:10px; border-radius:5px; overflow:hidden;">
                <div id="progress-indicator"
                    style="height:100%; background:var(--primary); width:0%; transition:width 0.5s;"></div>
            </div>
        </div>

        <div id="report-loading-overlay" class="report-loading-overlay">
            <div class="loading-text" id="loading-main-text">ë³´ê³ ì„œ ìƒì„± ì¤‘...</div>
            <div class="loading-animation">
                <div class="loading-bar" id="report-loading-bar"></div>
            </div>
            <div class="loading-subtext" id="loading-sub-text">ë¶„ì„ ë°ì´í„°ë¥¼ ì •ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.</div>
        </div>

        <!-- 1. Quiz Screen -->
        <div id="screen-quiz" class="screen active">
            <div class="header-row">
                <div style="width:100px;"></div> <!-- Spacer -->
                <h2 style="margin:0;">ğŸ§© ë³µìŠµ í€´ì¦ˆ</h2>
                <button class="action-btn secondary" style="width:auto; padding:8px 15px; font-size:0.9rem;"
                    onclick="showScreen('screen-level')">í™œë™ìœ¼ë¡œ ë°”ë¡œ ê°€ê¸° â”</button>
            </div>
            <p class="text-center mb-6">ì„¤ëª…í•˜ëŠ” ê¸€ì˜ êµ¬ì¡°ë¥¼ ì˜ ì•Œê³  ìˆëŠ”ì§€ í™•ì¸í•´ë³¼ê¹Œìš”?</p>

            <div id="quiz-container" style="max-width:850px; margin:0 auto;">
                <!-- Dynamic Quiz Content -->
            </div>
            <center>
                <div id="quiz-feedback" class="feedback-msg" style="max-width:850px;"></div>
            </center>

            <div id="quiz-next-btn-container" style="text-align:center; margin-top:20px; display:none;">
                <button class="action-btn" onclick="nextQuiz()">ë‹¤ìŒ ë¬¸ì œë¡œ â”</button>
            </div>
        </div>

        <!-- 1.1 Activity Pledge (Announcement) -->
        <div id="screen-pledge" class="screen">
            <div class="header-row">
                <button class="back-btn" onclick="showScreen('screen-quiz')">â—€ í€´ì¦ˆë¡œ</button>
                <h2 style="margin:0;">ğŸŒŸ í™œë™ ì¤€ë¹„í•˜ê¸°</h2>
                <div style="width:80px;"></div>
            </div>
            <div class="selection-card" style="max-width:600px; margin:40px auto; cursor:default; padding:40px;">
                <h2 style="margin-bottom:20px;">ğŸŒŸ ì´ì œ ì‹¤ì œ ê¸€ì„ ë¶„ì„í•´ë³¼ ê±°ì˜ˆìš”!</h2>
                <div
                    style="background:#f1f5f9; padding:25px; border-radius:15px; margin-bottom:25px; text-align:left; line-height:1.7;">
                    <p
                        style="font-size:1.1rem; margin-bottom:15px; border-bottom:2px solid #cbd5e1; padding-bottom:10px;">
                        ìš°ë¦¬ëŠ” ë°°ìš´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ <strong>5ê°€ì§€ ë¯¸ì…˜</strong>ì„ ìˆ˜í–‰í•  ê±°ì˜ˆìš”.</p>
                    <ul style="margin:10px 0; padding-left:20px; list-style-type: 'âœ”ï¸ ';">
                        <li style="margin-bottom:8px;"><strong>1ë‹¨ê³„</strong>: ì£¼ì œ ì°¾ê¸°</li>
                        <li style="margin-bottom:8px;"><strong>2ë‹¨ê³„</strong>: ì¤‘ì‹¬ë¬¸ì¥ í™•ì¸í•˜ê¸°</li>
                        <li style="margin-bottom:8px;"><strong>3ë‹¨ê³„</strong>: í‘œì§€ì–´(í‚¤ì›Œë“œ) ì°¾ê¸°</li>
                        <li style="margin-bottom:8px;"><strong>4ë‹¨ê³„</strong>: ê¸€ì˜ êµ¬ì¡° ì„ íƒí•˜ê¸°</li>
                        <li style="margin-bottom:8px;"><strong>5ë‹¨ê³„</strong>: êµ¬ì¡° ê·¸ë¦¼ ì™„ì„±í•˜ê³  ìš”ì•½í•˜ê¸°</li>
                    </ul>
                    <p style="margin-top:20px; color:#475569;">ë¶„ì„ì„ ì‹œì‘í•˜ê¸° ì „, ë‚˜ì˜ ë©‹ì§„ <strong>ë‹¤ì§</strong>ì„ ì ì–´ë³¼ê¹Œìš”?</p>
                </div>

                <textarea id="pledge-input" placeholder="ì˜ˆ: ê¸€ì„ ê¼¼ê¼¼í•˜ê²Œ ì½ê³  ì •í™•í•˜ê²Œ ìš”ì•½í•´ ë³´ê² ì–´! ğŸ”¥"
                    style="width:100%; height:120px; padding:15px; border-radius:10px; border:2px solid #e2e8f0; font-size:1.05rem; margin-bottom:25px; font-family:inherit; resize:none;"></textarea>

                <button class="action-btn" style="width:100%; padding:15px;" onclick="finishPledge()">í™œë™ ì‹œì‘í•˜ê¸°
                    ğŸš€</button>
            </div>
        </div>

        <!-- 2. Level Selection -->
        <div id="screen-level" class="screen">
            <div class="header-row">
                <button class="back-btn" onclick="showScreen('screen-quiz')">â—€ í€´ì¦ˆë¡œ</button>
                <h2 style="margin:0;">ğŸš€ ë„ì „í•  ë‹¨ê³„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
                <div style="width:80px;"></div> <!-- Spacer -->
            </div>
            <div class="card-grid">
                <div class="selection-card" onclick="startGame('beginner')">
                    <div class="card-icon">ğŸ£</div>
                    <h3>ì´ˆê¸‰</h3>
                    <p>ì§§ì€ ê¸€, ì‰¬ìš´ êµ¬ì¡°</p>
                </div>
                <div class="selection-card" onclick="startGame('intermediate')">
                    <div class="card-icon">ğŸƒ</div>
                    <h3>ì¤‘ê¸‰</h3>
                    <p>ë¬¸ë‹¨ì´ ìˆëŠ” ê¸€</p>
                </div>
                <div class="selection-card" onclick="startGame('advanced')">
                    <div class="card-icon">ğŸ§—</div>
                    <h3>ìƒê¸‰</h3>
                    <p>ë³µì¡í•œ êµ¬ì¡°ì˜ ê¸´ ê¸€</p>
                </div>
            </div>
        </div>

        <!-- 3. Main Game Area (5 Steps) -->
        <div id="screen-game" class="screen">
            <div class="header-row">
                <button class="back-btn" onclick="showScreen('screen-level')">â—€ ë ˆë²¨ ì„ íƒ</button>
                <h2 style="margin:0;" id="game-title-step">ê¸€ ë¶„ì„í•˜ê¸°</h2>
                <div style="width:80px;"></div> <!-- Spacer -->
            </div>

            <div class="game-layout-container">
                <div class="split-view" style="flex:1;">
                    <!-- Text Area (Left) -->
                    <div class="text-panel-header"
                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <span style="font-weight:bold; color:var(--primary);">ğŸ“– ë³¸ë¬¸ ì½ê¸°</span>
                    </div>
                    <div class="text-panel" id="text-panel"
                        style="background:#fff; border-radius:12px; padding:30px; border:1px solid #e2e8f0; margin-bottom:20px;">
                        <!-- Dynamic Text Content with Hints -->
                    </div>

                    <!-- Interaction Area (Right) -->
                    <!-- Interaction Area (Right) -->
                    <!-- Unified Activity Panel -->
                    <div class="activity-panel" id="activity-panel"
                        style="display:flex; flex-direction:column; gap:20px;">
                        <div id="game-step-content" class="step-content"
                            style="display:block; background:white; border:1px solid #e2e8f0; border-radius:12px; padding:20px;">
                            <!-- Content dynamically swapped between structure selection and diagram builder -->
                        </div>

                        <div id="step-feedback" class="feedback-msg"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. Report Screen -->
        <div id="screen-report" class="screen">
            <div class="header-row">
                <button class="back-btn" onclick="showScreen('screen-level')">â—€ ë ˆë²¨ ì„ íƒ</button>
                <h2 style="margin:0;">ğŸ‰ ë¯¸ì…˜ ì„±ê³µ! í•™ìŠµ ë³´ê³ ì„œ</h2>
                <div style="width:80px;"></div>
            </div>
            <div class="report-paper">
                <!-- Decorative Elements -->
                <div class="report-corner corner-tl"></div>
                <div class="report-corner corner-tr"></div>
                <div class="report-corner corner-bl"></div>
                <div class="report-corner corner-br"></div>
                <div class="seal">ë¯¸ì…˜<br>ì„±ê³µ</div>

                <div class="report-header"
                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <h2 style="margin:0; color:var(--primary-dark);">ğŸ“‘ ë…í•´ ë¶„ì„ ê²°ê³¼ ë³´ê³ ì„œ</h2>
                    <div class="final-score" style="font-size:1.5rem; font-weight:bold; color:var(--primary);">ì´ì : <span
                            id="final-score-display">0</span>ì </div>
                </div>
                <div style="font-size:0.9rem; color:#64748b; margin-bottom:20px; text-align:right;">
                    í•™ìŠµ ì¼ì‹œ: <span id="report-date"></span> | ë ˆë²¨: <span id="report-level-text"></span>
                </div>
                <hr style="margin-bottom:25px; border:1px solid #f1f5f9;">
                <div class="report-section" style="margin-bottom:30px;">
                    <h4 style="margin-bottom:10px; color:var(--primary-dark); font-size:1.1rem;">1. ë¶„ì„í•œ ë³¸ë¬¸</h4>
                    <div id="report-text" class="text-panel"
                        style="background:#fcfdfd; border:1px solid #eef2f6; padding:15px; font-size:0.95rem; border-radius:10px;">
                    </div>
                </div>
                <div class="report-section" style="margin-bottom:30px;">
                    <h4 style="margin-bottom:10px; color:var(--primary-dark); font-size:1.1rem;">2. ê¸€ì˜ êµ¬ì¡° ë° ì„ íƒ ì´ìœ </h4>
                    <div
                        style="background:#eff6ff; border:1px solid #dbeafe; padding:15px; border-radius:10px; font-size:0.95rem;">
                        <span style="font-weight:bold; color:#1e40af;">ì„ íƒí•œ êµ¬ì¡°:</span> <span
                            id="report-structure-name"></span><br>
                        <span style="font-weight:bold; color:#1e40af;">ì„ íƒí•œ ì´ìœ :</span> <span id="report-structure-reason"
                            style="color:#1d4ed8;"></span>
                    </div>
                </div>
                <div class="report-section" style="margin-bottom:30px;">
                    <h4 style="margin-bottom:10px; color:var(--primary-dark); font-size:1.1rem;">3. ê¸€ì˜ êµ¬ì¡° ë¶„ì„ (ë„í•´ì¡°ì§ì)
                    </h4>
                    <div style="background:#f8fafc; padding:15px; border-radius:10px; border:1px solid #e2e8f0;">
                        <p style="margin-bottom:10px; font-weight:bold;">ë¶„ì„ êµ¬ì¡°: <span id="report-structure"
                                style="color:var(--primary);"></span></p>
                        <div id="report-diagram-view" style="transform: scale(0.95); transform-origin: top center;">
                        </div>
                    </div>
                </div>
                <!-- Final Summary Section in Report -->
                <div class="report-section" style="margin-bottom:30px;">
                    <h4 style="margin-bottom:10px; color:var(--primary-dark); font-size:1.1rem;">4. ë‚˜ì˜ ìµœì¢… ìš”ì•½</h4>
                    <div id="report-user-summary"
                        style="background:#fffbeb; border:1px solid #fef3c7; padding:20px; border-radius:12px; font-size:1rem; color:#92400e; line-height:1.8; white-space:pre-wrap;">
                        <!-- Dynamically filled -->
                    </div>
                </div>
            </div>
            <!-- Recommendations Section -->
            <div class="report-section" style="margin-top:40px; border-top: 2px solid #f1f5f9; padding-top:20px;">
                <h3 id="report-summary-title"
                    style="margin-top:0; border-bottom:2px solid #e2e8f0; padding-bottom:8px; color:var(--primary-dark);">
                    5. ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©ê³¼ ì†Œê°ì„ ê°„ë‹¨í•˜ê²Œ ì ì–´ë³´ì„¸ìš”.</h3>
                <h4 style="margin-bottom:15px; color:var(--primary-dark);">ğŸŒŸ ë‚˜ì—ê²Œ ë§ëŠ” ì¶”ì²œ í™œë™</h4>
                <div id="report-recommendations" style="display:flex; flex-direction:column; gap:12px;">
                    <!-- Dynamically filled -->
                </div>
            </div>

            <div class="report-export-buttons no-print">
                <button class="action-btn"
                    style="width:auto; background: #059669; box-shadow: 0 4px 12px rgba(5, 150, 105, 0.2);"
                    onclick="exportReport('jpg')">ğŸ“¥ ì´ë¯¸ì§€ë¡œ ì €ì¥ (JPG)</button>
                <button class="action-btn"
                    style="width:auto; background: #0891b2; box-shadow: 0 4px 12px rgba(8, 145, 178, 0.2);"
                    onclick="exportReport('pdf')">ğŸ“„ PDFë¡œ ì €ì¥ / ì¸ì‡„</button>
                <button class="action-btn secondary" style="width:auto; background: #64748b; color: white;"
                    onclick="location.reload()">ğŸ’¾ ì €ì¥ í›„ ì²˜ìŒìœ¼ë¡œ</button>
            </div>
        </div> <!-- End screen-report -->

        <!-- 5. History Screen -->
        <div id="screen-history" class="screen">
            <div class="header-row">
                <button class="back-btn" onclick="showScreen('screen-level')">â—€ ë ˆë²¨ ì„ íƒ</button>
                <h2 style="margin:0;">ğŸ“œ ë‚´ê°€ ë§Œë“  ë³´ê³ ì„œ</h2>
                <div style="width:80px;"></div>
            </div>
            <p class="text-center mb-6">ì§€ê¸ˆê¹Œì§€ ë¶„ì„í•œ ë‚˜ì˜ ê¸°ë¡ë“¤ì„ ëª¨ì•„ë³´ì„¸ìš”.</p>

            <div id="history-empty" style="text-align:center; padding:50px; display:none;">
                <div style="font-size:4rem; margin-bottom:20px;">ğŸœï¸</div>
                <h3 style="color:#64748b;">ì•„ì§ ì €ì¥ëœ ë³´ê³ ì„œê°€ ì—†ì–´ìš”.</h3>
                <p style="color:#94a3b8; margin-top:10px;">í™œë™ì„ ì™„ë£Œí•˜ê³  ë©‹ì§„ ë³´ê³ ì„œë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
                <button class="action-btn" style="width:auto; margin-top:30px; padding:12px 30px;"
                    onclick="showScreen('screen-level')">í™œë™ ì‹œì‘í•˜ê¸° â”</button>
            </div>

            <div id="history-list" class="card-grid" style="margin-top:20px;">
                <!-- Saved reports will be listed here -->
            </div>

            <div style="text-align:center; margin-top:40px;" class="no-print">
                <button class="action-btn secondary" style="width:auto; padding:10px 20px;" onclick="clearHistory()">ê¸°ë¡
                    ëª¨ë‘ ì§€ìš°ê¸° ğŸ—‘ï¸</button>
            </div>
        </div>
    </div> <!-- End container -->


    <div id="image-zoom-modal" class="zoom-modal" style="display: none;" onclick="this.style.display='none'">
        <img id="zoomed-image" src="">
    </div>

    <script>
        /* [DATA] --------------------------------------------- */
        const QuizData = [
            {
                type: 'short-answer',
                q: "1. ì„¤ëª…í•˜ëŠ” ê¸€ì˜ êµ¬ì¡°ì—ëŠ” ì–´ë–¤ ê²ƒì´ ìˆì—ˆë‚˜ìš”? (3ê°€ì§€ë¥¼ ëª¨ë‘ ì ì–´ë³´ì„¸ìš”)",
                answers: ["ì—´ê±°", "ìˆœì„œ", "ë¹„êµ,ëŒ€ì¡°"],
                initialHints: "ã…‡ã„±, ã……ã……, ã…‚ã„± ì™€ ã„·ã…ˆ",
                explanation: "ì„¤ëª…í•˜ëŠ” ê¸€ì˜ ëŒ€í‘œì ì¸ êµ¬ì¡°ëŠ” ì—´ê±° êµ¬ì¡°, ìˆœì„œ êµ¬ì¡°, ë¹„êµì™€ ëŒ€ì¡° êµ¬ì¡°ê°€ ìˆìŠµë‹ˆë‹¤."
            },
            {
                type: 'drag-table',
                q: "2. ê° ë„í•´ì¡°ì§ìì— ì•Œë§ì€ ì„¤ëª…í•˜ëŠ” ê¸€ì˜ êµ¬ì¡°ì™€ ê·¸ì— ëŒ€í•œ ì„¤ëª…ì„ ë“œë˜ê·¸ í•˜ì—¬ í‘œë¥¼ ì™„ì„±í•˜ì‹œì˜¤.",
                items: [
                    { id: 'enum', title: "ì—´ê±° êµ¬ì¡°", graphic: "media__1771412640081.png", desc: "íŠ¹ì§•ì´ë‚˜ ì¥ì  ë“±ì„ ë‚˜ì—´í•¨" },
                    { id: 'seq', title: "ìˆœì„œ êµ¬ì¡°", graphic: "media__1771412699401.png", desc: "ì‹œê°„ì´ë‚˜ ê³¼ì •ì˜ ìˆœì„œëŒ€ë¡œ ì„¤ëª…í•¨" },
                    { id: 'comp', title: "ë¹„êµì™€ ëŒ€ì¡°", graphic: "media__1771412769838.png", desc: "ê³µí†µì ê³¼ ì°¨ì´ì ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ëª…í•¨" }
                ],
                explanation: "ë„í•´ì¡°ì§ìì˜ ëª¨ì–‘ì„ ë³´ê³  ì–´ë–¤ êµ¬ì¡°ì¸ì§€, ì–´ë–¤ íŠ¹ì§•ì´ ìˆëŠ”ì§€ ì—°ê²°í•´ ë³´ì„¸ìš”."
            }
        ];

        /* Texts are grouped by Level. */
        const GameData = {
            beginner: [
                {
                    type: 'enum',
                    keyword: 'ìì„',
                    title: 'ìì„ì˜ ì„±ì§ˆê³¼ ì´ìš©',
                    paragraphs: [
                        { text: "  ìì„ì€ ìš°ë¦¬ ìƒí™œ ê³³ê³³ì—ì„œ ì“°ì´ê³  ìˆìŠµë‹ˆë‹¤. ìì„ì´ ì–´ë””ì— ì“°ì´ëŠ”ì§€ ì‚´í´ë´…ì‹œë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì²«ì§¸, ìì„ì€ ëƒ‰ì¥ê³  ë¬¸ì— ì“°ì…ë‹ˆë‹¤. ëƒ‰ì¥ê³  ë¬¸ í…Œë‘ë¦¬ ì•ˆìª½ì—ëŠ” ê°€ëŠë‹¤ë€ ìì„ì´ ë“¤ì–´ ìˆìŠµë‹ˆë‹¤. ì´ ìì„ ë•ë¶„ì— ëƒ‰ì¥ê³  ë¬¸ì´ ë”± ë‹¬ë¼ë¶™ì–´ ë‹«íˆê³ , ì°¬ ê³µê¸°ê°€ ë°–ìœ¼ë¡œ ë‚˜ì˜¤ì§€ ì•ŠìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë‘˜ì§¸, ìì„ì€ í•„í†µì´ë‚˜ ê°€ë°©ì˜ ì ê¸ˆì¥ì¹˜ì— ì“°ì…ë‹ˆë‹¤. ë‹¨ì¶”ì²˜ëŸ¼ ìƒê¸´ ìì„ ë‘ ê°œê°€ ì„œë¡œ ë¶™ëŠ” í˜ì„ ì´ìš©í•´ ëšœê»‘ì´ë‚˜ ë®ê°œë¥¼ ì—¬ë‹«ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì§€í¼ë³´ë‹¤ ê°„í¸í•˜ê²Œ ì—´ê³  ë‹«ì„ ìˆ˜ ìˆì–´ì„œ í¸ë¦¬í•©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì…‹ì§¸, ìì„ì€ ìŠ¤í”¼ì»¤ ì•ˆì—ë„ ë“¤ì–´ ìˆìŠµë‹ˆë‹¤. ìŠ¤í”¼ì»¤ëŠ” ìì„ê³¼ ì½”ì¼ì´ í•¨ê»˜ ì›€ì§ì´ë©° ì†Œë¦¬ë¥¼ ë§Œë“¤ì–´ ëƒ…ë‹ˆë‹¤. ìš°ë¦¬ê°€ ìŒì•…ì„ ë“£ê±°ë‚˜ ì˜ìƒì˜ ì†Œë¦¬ë¥¼ ë“¤ì„ ìˆ˜ ìˆëŠ” ê²ƒë„ ìì„ ë•ë¶„ì…ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì´ì²˜ëŸ¼ ìì„ì€ ëƒ‰ì¥ê³ , ê°€ë°©, ìŠ¤í”¼ì»¤ ë“± ìš°ë¦¬ ìƒí™œì˜ ì—¬ëŸ¬ ê³³ì—ì„œ ì¤‘ìš”í•œ ì—­í• ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 }
                    ]
                },
                {
                    type: 'seq',
                    keyword: 'ë´‰ìˆ­ì•„',
                    title: 'ë´‰ìˆ­ì•„ í‚¤ìš°ê¸°',
                    paragraphs: [
                        { text: "  ë´‰ìˆ­ì•„ëŠ” í‚¤ìš°ê¸° ì‰¬ìš´ ì‹ë¬¼ì…ë‹ˆë‹¤. ìˆœì„œëŒ€ë¡œ ë”°ë¼ í•˜ë©´ ëˆ„êµ¬ë‚˜ ë´‰ìˆ­ì•„ë¥¼ í‚¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë¨¼ì €, ì”¨ì•—ì„ ì‹¬ì„ ì¤€ë¹„ë¥¼ í•©ë‹ˆë‹¤. í™”ë¶„ì— í™ì„ 3ë¶„ì˜ 2 ì •ë„ ì±„ìš´ ë’¤, ì†ê°€ë½ìœ¼ë¡œ 1ì„¼í‹°ë¯¸í„° ê¹Šì´ì˜ êµ¬ë©ì„ ë‘ì„¸ ê°œ ë§Œë“­ë‹ˆë‹¤. êµ¬ë©ë§ˆë‹¤ ì”¨ì•—ì„ í•œë‘ ê°œì”© ë„£ê³  í™ìœ¼ë¡œ ì‚´ì‚´ ë®ì–´ ì¤ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë‹¤ìŒìœ¼ë¡œ, ë¬¼ì„ ì£¼ê³  í–‡ë¹›ì´ ì˜ ë“œëŠ” ê³³ì— ë†“ì•„ ë‘¡ë‹ˆë‹¤. í™ì´ ë§ˆë¥´ì§€ ì•Šë„ë¡ í•˜ë£¨ì— í•œ ë²ˆ ë¬¼ì„ ì¤ë‹ˆë‹¤. ë„ˆë¬´ ë§ì´ ì£¼ë©´ ì”¨ì•—ì´ ì©ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í™ì´ ì´‰ì´‰í•œ ì •ë„ê°€ ì ë‹¹í•©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ê·¸ë‹¤ìŒìœ¼ë¡œ, ì‹¹ì´ íŠ¸ë©´ íŠ¼íŠ¼í•œ ì‹¹ë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ëŠ” ì†ì•„ ì¤ë‹ˆë‹¤. ì‹¹ì´ ì„œë¡œ ë„ˆë¬´ ê°€ê¹Œì´ ìˆìœ¼ë©´ ì˜ ìë¼ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì†ì•„ ë‚¸ ìë¦¬ì˜ í™ì„ ì†ê°€ë½ìœ¼ë¡œ ì‚´ì§ ëˆŒëŸ¬ ê³ ë¥´ê²Œ í•´ ì¤ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë§ˆì§€ë§‰ìœ¼ë¡œ, ê¾¸ì¤€íˆ ë¬¼ì„ ì£¼ë©° ê¸°ë‹¤ë¦¬ë©´ 4~6ì£¼ ë’¤ì— ê½ƒì´ í•ë‹ˆë‹¤. ë¶‰ê³  ë¶„í™ë¹›ì˜ ë´‰ìˆ­ì•„ê½ƒì´ í”¼ë©´, ê½ƒìì„ ë”°ì„œ ì†í†±ì„ ë¬¼ë“¤ì´ëŠ” ì „í†µ ë†€ì´ë„ ì¦ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 }
                    ]
                },
                {
                    type: 'comp',
                    keyword: 'ë„ì„œê´€',
                    title: 'ë„ì„œê´€ê³¼ ì„œì ',
                    paragraphs: [
                        { text: "  ìš°ë¦¬ ì£¼ë³€ì—ì„œ ë„ì„œê´€ê³¼ ì„œì ì„ ì‰½ê²Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‘ ê³³ ëª¨ë‘ ì±…ê³¼ ì¹œí•´ì§ˆ ìˆ˜ ìˆëŠ” ê³³ì´ì§€ë§Œ, ì„œë¡œ ë‹¤ë¥¸ ì ë„ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë¨¼ì €, ë„ì„œê´€ê³¼ ì„œì ì€ ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ ì±…ì„ ê°–ì¶”ê³  ìˆë‹¤ëŠ” ì ì—ì„œ ê°™ìŠµë‹ˆë‹¤. ê·¸ë¦¼ì±…, ì†Œì„¤, ê³¼í•™ì±… ë“± ì—¬ëŸ¬ ë¶„ì•¼ì˜ ì±…ì´ ìˆê³ , ì¡°ìš©í•œ í™˜ê²½ì—ì„œ ì±…ì„ ì½ì„ ìˆ˜ ìˆë‹¤ëŠ” ì ë„ ê³µí†µì ì…ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë°˜ë©´ì—, ë„ì„œê´€ì€ ì±…ì„ ë¹Œë ¤ ë³´ëŠ” ê³³ì…ë‹ˆë‹¤. íšŒì›ì¦ì„ ë§Œë“¤ë©´ ëˆì„ ë‚´ì§€ ì•Šê³  ì±…ì„ ì§‘ì— ê°€ì ¸ê°€ì„œ ì½ì„ ìˆ˜ ìˆê³ , ë‹¤ ì½ì€ í›„ì—ëŠ” ë‹¤ì‹œ ëŒë ¤ì£¼ë©´ ë©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì´ì™€ ë‹¬ë¦¬, ì„œì ì€ ì±…ì„ ì‚¬ëŠ” ê³³ì…ë‹ˆë‹¤. ë„ì„œê´€ì—ëŠ” ì˜¤ë˜ëœ ì±…ì´ë‚˜ ê³µë¶€í•  ë•Œ í•„ìš”í•œ ì±…ë“¤ì´ ë§ì€ ë°˜ë©´, ì„œì ì—ëŠ” ìš”ì¦˜ ìƒˆë¡œ ë‚˜ì˜¨ ì±…ë“¤ì„ ë°”ë¡œ ë§Œë‚˜ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì´ì²˜ëŸ¼ ë„ì„œê´€ê³¼ ì„œì ì€ ì±…ì„ ê°€ê¹Œì´í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì—ì„œëŠ” ê°™ì§€ë§Œ, ì´ìš© ë°©ë²•ê³¼ ì±…ì˜ ì¢…ë¥˜ì—ì„œëŠ” ì„œë¡œ ë‹¤ë¦…ë‹ˆë‹¤. ë‘ ê³³ì˜ íŠ¹ì§•ì„ ì˜ ì•Œê³  ìƒí™©ì— ë§ê²Œ ì´ìš©í•˜ë©´ ì±…ê³¼ ë” ì¹œí•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 }
                    ]
                }
            ],
            intermediate: [
                {
                    type: 'enum',
                    keyword: 'ìƒíƒœê³„',
                    title: 'ìƒíƒœê³„ì˜ êµ¬ì„±ê³¼ ì—­í• ',
                    paragraphs: [
                        { text: "  ìš°ë¦¬ê°€ ì‚¬ëŠ” ì§€êµ¬ì—ëŠ” ìˆ˜ë§ì€ ìƒë¬¼ë“¤ì´ ì„œë¡œ ì˜í–¥ì„ ì£¼ê³ ë°›ìœ¼ë©° ì‚´ì•„ê°€ê³  ìˆìŠµë‹ˆë‹¤. ìƒíƒœê³„ê°€ ê· í˜•ì„ ì´ë£¨ë©° ìœ ì§€ë  ìˆ˜ ìˆëŠ” ê²ƒì€ ê° ìƒë¬¼ë“¤ì´ ì €ë§ˆë‹¤ ë§¡ì€ ì—­í• ì„ ë‹¤í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ìƒíƒœê³„ë¥¼ êµ¬ì„±í•˜ëŠ” ìƒë¬¼ë“¤ì€ í¬ê²Œ ìƒì‚°ì, ì†Œë¹„ì, ë¶„í•´ìë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆìœ¼ë©°, ê°ê°ì˜ ì—­í• ì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì²«ì§¸, ìƒì‚°ìëŠ” í–‡ë¹›ì„ ì´ìš©í•˜ì—¬ ìŠ¤ìŠ¤ë¡œ ì–‘ë¶„ì„ ë§Œë“œëŠ” ìƒë¬¼ì…ë‹ˆë‹¤. í’€, ë‚˜ë¬´, ìˆ˜ë ¨, í•´ì¡°ë¥˜ì™€ ê°™ì€ ì‹ë¬¼ì´ ëŒ€í‘œì ì¸ ìƒì‚°ìì…ë‹ˆë‹¤. ì´ë“¤ì€ ê´‘í•©ì„±ì„ í†µí•´ ì´ì‚°í™” íƒ„ì†Œì™€ ë¬¼ì„ ì–‘ë¶„ìœ¼ë¡œ ë°”ê¾¸ê³ , ì´ ê³¼ì •ì—ì„œ ì‚°ì†Œë¥¼ ë‚´ë³´ëƒ…ë‹ˆë‹¤. ìƒì‚°ìê°€ ë§Œë“¤ì–´ ë‚¸ ì–‘ë¶„ì€ ìƒíƒœê³„ì˜ ëª¨ë“  ìƒë¬¼ë“¤ì´ ì‚´ì•„ê°€ëŠ” ë° í•„ìš”í•œ ì—ë„ˆì§€ì˜ ì¶œë°œì ì´ ë©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë‘˜ì§¸, ì†Œë¹„ìëŠ” ë‹¤ë¥¸ ìƒë¬¼ì„ ë¨¹ì–´ì„œ ì–‘ë¶„ì„ ì–»ëŠ” ìƒë¬¼ì…ë‹ˆë‹¤. ì‹ë¬¼ì„ ì§ì ‘ ë¨¹ëŠ” í† ë¼, ë©”ëšœê¸°, ì‚¬ìŠ´ê³¼ ê°™ì€ ì´ˆì‹ ë™ë¬¼ì€ 1ì°¨ ì†Œë¹„ìë¼ê³  í•©ë‹ˆë‹¤. ì´ ì´ˆì‹ ë™ë¬¼ì„ ì¡ì•„ë¨¹ëŠ” ì—¬ìš°, ê°œêµ¬ë¦¬, ë±€ ê°™ì€ ìœ¡ì‹ ë™ë¬¼ì€ 2ì°¨ ì†Œë¹„ìì…ë‹ˆë‹¤. ì´ì²˜ëŸ¼ ì†Œë¹„ìë“¤ì€ ë¨¹ê³  ë¨¹íˆëŠ” ë¨¹ì´ ì‚¬ìŠ¬ì„ ì´ë£¨ë©° ì„œë¡œ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ í•œ ì¢…ë¥˜ì˜ ì†Œë¹„ìê°€ ì§€ë‚˜ì¹˜ê²Œ ëŠ˜ì–´ë‚˜ê±°ë‚˜ ì¤„ì–´ë“¤ë©´ ìƒíƒœê³„ ì „ì²´ì˜ ê· í˜•ì´ ë¬´ë„ˆì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì…‹ì§¸, ë¶„í•´ìëŠ” ì£½ì€ ìƒë¬¼ì´ë‚˜ ë°°ì„¤ë¬¼ì„ ë¶„í•´í•˜ì—¬ ìì—°ìœ¼ë¡œ ëŒë ¤ë³´ë‚´ëŠ” ìƒë¬¼ì…ë‹ˆë‹¤. ë²„ì„¯, ê³°íŒ¡ì´, ì„¸ê·  ë“±ì´ ëŒ€í‘œì ì¸ ë¶„í•´ìì…ë‹ˆë‹¤. ë¶„í•´ìê°€ ì—†ë‹¤ë©´ ìƒë¬¼ì˜ ì‚¬ì²´ì™€ ë°°ì„¤ë¬¼ì´ ì§€êµ¬ì— ê³„ì† ìŒ“ì—¬ ìƒíƒœê³„ê°€ ìˆœí™˜ë˜ì§€ ëª»í•  ê²ƒì…ë‹ˆë‹¤. ë¶„í•´ìê°€ ìœ ê¸°ë¬¼ì„ ë¬´ê¸°ë¬¼ë¡œ ë˜ëŒë ¤ ë†“ì•„ì•¼ ë¹„ë¡œì†Œ ì‹ë¬¼ì´ ë‹¤ì‹œ ê·¸ ë¬¼ì§ˆì„ í¡ìˆ˜í•˜ì—¬ ì–‘ë¶„ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì´ì²˜ëŸ¼ ìƒì‚°ì, ì†Œë¹„ì, ë¶„í•´ìëŠ” ê°ê° ë‹¤ë¥¸ ì—­í• ì„ ë§¡ê³  ìˆì§€ë§Œ, ì„œë¡œ ì´˜ì´˜íˆ ì—°ê²°ë˜ì–´ ìƒíƒœê³„ë¥¼ ì§€íƒ±í•©ë‹ˆë‹¤. ì–´ëŠ í•˜ë‚˜ë¼ë„ ì‚¬ë¼ì§„ë‹¤ë©´ ìƒíƒœê³„ì˜ ê· í˜•ì€ ê¹¨ì§ˆ ìˆ˜ë°–ì— ì—†ìŠµë‹ˆë‹¤. ìš°ë¦¬ê°€ í™˜ê²½ì„ ë³´í˜¸í•´ì•¼ í•˜ëŠ” ì´ìœ ë„ ë°”ë¡œ ì´ ì—°ê²° ê³ ë¦¬ë¥¼ ì§€í‚¤ê¸° ìœ„í•´ì„œì…ë‹ˆë‹¤.", mainSentenceIndex: 0 }
                    ]
                },
                {
                    type: 'seq',
                    keyword: 'ë²•',
                    title: 'ë²•ì´ ë§Œë“¤ì–´ì§€ëŠ” ê³¼ì •',
                    paragraphs: [
                        { text: "  ìš°ë¦¬ ì‚¬íšŒì—ëŠ” êµí†µ ì‹ í˜¸ë¥¼ ì§€ì¼œì•¼ í•œë‹¤ê±°ë‚˜, ì“°ë ˆê¸°ë¥¼ í•¨ë¶€ë¡œ ë²„ë¦¬ë©´ ì•ˆ ëœë‹¤ëŠ” ë“± ìˆ˜ë§ì€ ê·œì¹™ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê·œì¹™ ê°€ìš´ë° êµ­ê°€ê°€ ê³µì‹ì ìœ¼ë¡œ ì •í•œ ê²ƒì„ ë²•ì´ë¼ê³  í•©ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ìš°ë¦¬ê°€ ì§€ì¼œì•¼ í•˜ëŠ” ë²•ì€ ì–´ë–¤ ê³¼ì •ì„ ê±°ì³ ë§Œë“¤ì–´ì§ˆê¹Œìš”?", mainSentenceIndex: 0 },
                        { text: "  ë¨¼ì €, ë²•ì´ í•„ìš”í•˜ë‹¤ëŠ” ì˜ê²¬ì´ ëª¨ì…ë‹ˆë‹¤. ì‚¬íšŒ ë¬¸ì œê°€ ìƒê¸°ê±°ë‚˜ ìƒˆë¡œìš´ ê·œì¹™ì´ í•„ìš”í•˜ë‹¤ê³  ëŠë‚€ êµ­ë¯¼ë“¤ì´ ì˜ê²¬ì„ ì œì‹œí•˜ë©´, êµ­ë¯¼ì´ ì§ì ‘ ì„ ì¶œí•œ ëŒ€í‘œì¸ êµ­íšŒì˜ì›ì´ ê·¸ ì˜ê²¬ì„ ëª¨ì•„ ë²•ì˜ ì´ˆì•ˆì„ ì‘ì„±í•©ë‹ˆë‹¤. ì´ê²ƒì„ ë²•ë¥ ì•ˆì´ë¼ê³  í•©ë‹ˆë‹¤. êµ­íšŒì˜ì› í•œ ëª…ì´ ëŒ€í‘œë¡œ ë°œì˜í•˜ê±°ë‚˜ ì—¬ëŸ¬ ëª…ì´ í•¨ê»˜ ë°œì˜í•  ìˆ˜ ìˆìœ¼ë©°, ì •ë¶€ì—ì„œ ì œì¶œí•˜ê¸°ë„ í•©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë‹¤ìŒìœ¼ë¡œ, êµ­íšŒì—ì„œ ë²•ë¥ ì•ˆì„ ì‹¬ì‚¬í•˜ê³  í† ë¡ í•©ë‹ˆë‹¤. ì œì¶œëœ ë²•ë¥ ì•ˆì€ ê´€ë ¨ ë¶„ì•¼ ì „ë¬¸ê°€ë“¤ë¡œ êµ¬ì„±ëœ ìƒì„ìœ„ì›íšŒì—ì„œ ë¨¼ì € ê¼¼ê¼¼íˆ ê²€í† ë©ë‹ˆë‹¤. ë²•ì˜ ë‚´ìš©ì´ í—Œë²•ì— ì–´ê¸‹ë‚˜ì§€ëŠ” ì•ŠëŠ”ì§€, êµ­ë¯¼ì—ê²Œ ë¶ˆì´ìµì„ ì£¼ì§€ëŠ” ì•ŠëŠ”ì§€ ë“±ì„ ë”°ì§‘ë‹ˆë‹¤. í•„ìš”í•˜ë‹¤ë©´ ì „ë¬¸ê°€ë‚˜ ì‹œë¯¼ì˜ ì˜ê²¬ì„ ë“£ëŠ” ê³µì²­íšŒë¥¼ ì—´ê¸°ë„ í•©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ê·¸ë‹¤ìŒìœ¼ë¡œ, êµ­íšŒ ë³¸íšŒì˜ì—ì„œ íˆ¬í‘œë¥¼ í†µí•´ ì˜ê²°í•©ë‹ˆë‹¤. ìƒì„ìœ„ì›íšŒì˜ ì‹¬ì‚¬ë¥¼ í†µê³¼í•œ ë²•ë¥ ì•ˆì€ êµ­íšŒì˜ì› ì „ì²´ê°€ ëª¨ì¸ ë³¸íšŒì˜ì— ì˜¬ë¼ê°‘ë‹ˆë‹¤. ì¬ì  ì˜ì› ê³¼ë°˜ìˆ˜ê°€ ì¶œì„í•˜ê³ , ì¶œì„ ì˜ì› ê³¼ë°˜ìˆ˜ê°€ ì°¬ì„±í•˜ë©´ ë²•ë¥ ì•ˆì´ í†µê³¼ë©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ì˜ì›ë“¤ì€ ë²•ì´ êµ­ë¯¼ ì „ì²´ì—ê²Œ ì´ë¡œìš´ì§€ë¥¼ ì‹ ì¤‘í•˜ê²Œ ë”°ì ¸ íˆ¬í‘œí•©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì´ì–´ì„œ, í†µê³¼ëœ ë²•ë¥ ì•ˆì€ ëŒ€í†µë ¹ì´ ì„œëª…í•˜ê³  ê³µí¬í•©ë‹ˆë‹¤. êµ­íšŒë¥¼ í†µê³¼í•œ ë²•ë¥ ì•ˆì€ í–‰ì •ë¶€ì˜ ìˆ˜ë°˜ì¸ ëŒ€í†µë ¹ì—ê²Œ ì „ë‹¬ë©ë‹ˆë‹¤. ëŒ€í†µë ¹ì´ ì„œëª…í•˜ë©´ ë²•ë¥ ë¡œ í™•ì •ë˜ë©°, ê´€ë³´ì— ì‹¤ì–´ êµ­ë¯¼ì—ê²Œ ì•Œë¦¬ëŠ” ê²ƒì„ ê³µí¬ë¼ê³  í•©ë‹ˆë‹¤. ë§Œì•½ ëŒ€í†µë ¹ì´ ë²•ì•ˆì— ë¬¸ì œê°€ ìˆë‹¤ê³  íŒë‹¨í•˜ë©´ êµ­íšŒì— ë‹¤ì‹œ ê²€í† í•´ ë‹¬ë¼ê³  ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë§ˆì§€ë§‰ìœ¼ë¡œ, ê³µí¬ëœ ë²•ì€ ì¼ì • ê¸°ê°„ì´ ì§€ë‚œ í›„ ì‹œí–‰ë©ë‹ˆë‹¤. ë²•ì´ ê³µí¬ë˜ìë§ˆì ë°”ë¡œ ì ìš©ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, êµ­ë¯¼ì´ ìƒˆë¡œìš´ ë²•ì„ ì•Œê³  ì¤€ë¹„í•  ìˆ˜ ìˆë„ë¡ ì¼ì •í•œ ê¸°ê°„ì„ ë‘” ë’¤ì— íš¨ë ¥ì´ ë°œìƒí•©ë‹ˆë‹¤. ì´í›„ ë²•ì´ ì œëŒ€ë¡œ ì§€ì¼œì§€ëŠ”ì§€, ì‚¬íšŒ ë³€í™”ì— ë§ê²Œ ê³ ì¹  ë¶€ë¶„ì€ ì—†ëŠ”ì§€ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì‚´í´ë³´ë©° í•„ìš”í•˜ë©´ ê°œì •í•˜ê¸°ë„ í•©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì´ì²˜ëŸ¼ ë²•ì€ êµ­ë¯¼ì˜ ì˜ê²¬ì—ì„œ ì¶œë°œí•˜ì—¬ êµ­íšŒì˜ ì‹¬ì‚¬ì™€ ì˜ê²°, ëŒ€í†µë ¹ì˜ ê³µí¬ë¼ëŠ” ì—¬ëŸ¬ ë‹¨ê³„ë¥¼ ê±°ì³ ì™„ì„±ë©ë‹ˆë‹¤. ì´ ë³µì¡í•œ ì ˆì°¨ê°€ ìˆê¸°ì— ë²•ì´ í•¨ë¶€ë¡œ ë§Œë“¤ì–´ì§€ê±°ë‚˜ ë°”ë€Œì§€ ì•Šê³ , êµ­ë¯¼ì˜ ê¶Œë¦¬ì™€ ìƒí™œì„ ì•ˆì •ì ìœ¼ë¡œ ë³´í˜¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 }
                    ]
                },
                {
                    type: 'comp',
                    keyword: 'ë„ì‹œ',
                    title: 'ë„ì‹œì™€ ì´Œë½ì˜ ìƒí™œ',
                    paragraphs: [
                        { text: "  ìš°ë¦¬ë‚˜ë¼ ì‚¬ëŒë“¤ì€ ì €ë§ˆë‹¤ ë‹¤ë¥¸ í™˜ê²½ì—ì„œ ìƒí™œí•©ë‹ˆë‹¤. ì–´ë–¤ ì‚¬ëŒë“¤ì€ ë¹Œë”©ì´ ë¹½ë¹½í•œ ë„ì‹œì—ì„œ ì‚´ê³ , ì–´ë–¤ ì‚¬ëŒë“¤ì€ ë…¼ë°­ê³¼ ë°”ë‹¤ê°€ ê°€ê¹Œìš´ ì´Œë½ì—ì„œ ì‚½ë‹ˆë‹¤. ë„ì‹œì™€ ì´Œë½ì€ ëª¨ë‘ ì‚¬ëŒë“¤ì´ ëª¨ì—¬ ì‚¬ëŠ” ê³µê°„ì´ì§€ë§Œ, ê·¸ ëª¨ìŠµê³¼ ìƒí™œ ë°©ì‹ì—ëŠ” ê³µí†µì ê³¼ ì°¨ì´ì ì´ í•¨ê»˜ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë¨¼ì € ë‘ ì§€ì—­ì˜ ê³µí†µì ì„ ì‚´í´ë³´ë©´, ë„ì‹œì™€ ì´Œë½ ëª¨ë‘ ì‚¬ëŒë“¤ì´ ì¼ì„ í•˜ê³  ì—¬ê°€ë¥¼ ì¦ê¸°ë©° í•¨ê»˜ ì‚´ì•„ê°€ëŠ” ìƒí™œ ê³µê°„ì…ë‹ˆë‹¤. í•™êµ, ë³‘ì›, ì‹œì¥ ë“± ê¸°ë³¸ì ì¸ ìƒí™œ ì‹œì„¤ì´ ê°–ì¶”ì–´ì ¸ ìˆìœ¼ë©°, ì£¼ë¯¼ë“¤ì´ ì§€ì—­ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì§€ë°© ìì¹˜ ë‹¨ì²´ë¥¼ í†µí•´ ìŠ¤ìŠ¤ë¡œ ì§€ì—­ì„ ìš´ì˜í•œë‹¤ëŠ” ì ë„ ê°™ìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ê·¸ëŸ¬ë‚˜ ë‘ ì§€ì—­ì€ ì—¬ëŸ¬ ë©´ì—ì„œ ëšœë ·í•˜ê²Œ ë‹¤ë¦…ë‹ˆë‹¤. ìš°ì„  ì¸êµ¬ì™€ ë•…ì˜ ì´ìš© ë°©ì‹ì´ ë‹¤ë¦…ë‹ˆë‹¤. ë„ì‹œëŠ” ì¢ì€ ë•…ì— ë§ì€ ì‚¬ëŒì´ ëª¨ì—¬ ì‚´ê¸° ë•Œë¬¸ì— ì•„íŒŒíŠ¸, ì˜¤í”¼ìŠ¤ ë¹Œë”©, ìƒì—… ì‹œì„¤ ë“±ì´ ë°€ì§‘í•´ ìˆìŠµë‹ˆë‹¤. ë°˜ë©´, ì´Œë½ì€ ì¸êµ¬ê°€ ì ê³  ë•…ì´ ë„“ì–´ ë…¼, ë°­, ì–´ì¥, ëª©ì¥ì²˜ëŸ¼ ìì—°ì„ ì§ì ‘ ì´ìš©í•˜ëŠ” ê³µê°„ì´ ë§ìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë‹¤ìŒìœ¼ë¡œ ì£¼ë¯¼ë“¤ì˜ ì£¼ìš” ì§ì—…ì´ ë‹¤ë¦…ë‹ˆë‹¤. ë„ì‹œ ì£¼ë¯¼ë“¤ì€ íšŒì‚¬ì›, ê³µë¬´ì›, ì„œë¹„ìŠ¤ì—… ì¢…ì‚¬ìì²˜ëŸ¼ 2ì°¨Â·3ì°¨ ì‚°ì—…ì— ì¢…ì‚¬í•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ì´ì— ë¹„í•´ ì´Œë½ ì£¼ë¯¼ë“¤ì€ ë†ì—…, ì–´ì—…, ì„ì—…ì²˜ëŸ¼ ìì—°ì—ì„œ ì§ì ‘ ìƒì‚°ë¬¼ì„ ì–»ëŠ” 1ì°¨ ì‚°ì—…ì— ì¢…ì‚¬í•˜ëŠ” ë¹„ìœ¨ì´ ë†’ìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ìƒí™œ í¸ì˜ ì‹œì„¤ê³¼ ì¸êµ¬ ë³€í™”ì˜ ì¸¡ë©´ì—ì„œë„ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤. ë„ì‹œëŠ” êµí†µ, ì˜ë£Œ, ë¬¸í™” ì‹œì„¤ì´ í’ë¶€í•´ ìƒí™œì´ í¸ë¦¬í•˜ì§€ë§Œ, ì¸êµ¬ê°€ ì§‘ì¤‘ë˜ì–´ êµí†µ í˜¼ì¡, í™˜ê²½ ì˜¤ì—¼, ë†’ì€ ì§‘ê°’ ë“±ì˜ ë¬¸ì œê°€ ìƒê¸°ê¸°ë„ í•©ë‹ˆë‹¤. ë°˜ë©´, ì´Œë½ì€ ìì—°í™˜ê²½ì´ ì¾Œì í•˜ê³  ì§€ì—­ ê³µë™ì²´ ì˜ì‹ì´ ê°•í•˜ì§€ë§Œ, ì Šì€ ì¸êµ¬ê°€ ì¼ìë¦¬ë¥¼ ì°¾ì•„ ë„ì‹œë¡œ ë– ë‚˜ë©´ì„œ ì¸êµ¬ê°€ ì ì  ì¤„ì–´ë“œëŠ” ë¬¸ì œë¥¼ ê²ªê³  ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì´ì²˜ëŸ¼ ë„ì‹œì™€ ì´Œë½ì€ ì‚¬ëŒë“¤ì´ í•¨ê»˜ ì‚´ì•„ê°„ë‹¤ëŠ” ê³µí†µì ì„ ê°€ì§€ë©´ì„œë„, í™˜ê²½ê³¼ ì§ì—…, ìƒí™œ ë°©ì‹ì—ì„œ ëšœë ·í•œ ì°¨ì´ë¥¼ ë³´ì…ë‹ˆë‹¤. ì–´ëŠ ì§€ì—­ì´ ë” ë‚«ë‹¤ê³  ë‹¨ì •í•  ìˆ˜ëŠ” ì—†ìœ¼ë©°, ë‘ ì§€ì—­ì´ ì„œë¡œ ë¶€ì¡±í•œ ë¶€ë¶„ì„ ì±„ì›Œ ì£¼ê³  êµë¥˜í•˜ë©´ì„œ ê· í˜• ìˆê²Œ ë°œì „í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.", mainSentenceIndex: 0 }
                    ]
                }
            ],
            advanced: [
                {
                    type: 'enum',
                    keyword: 'ë‚ ì”¨',
                    title: 'ë‚ ì”¨ì™€ ìš°ë¦¬ ìƒí™œ',
                    paragraphs: [
                        { text: "  ìš°ë¦¬ëŠ” ë§¤ì¼ ì•„ì¹¨ ì°½ë¬¸ì„ ì—´ì–´ ë‚ ì”¨ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì¼ê¸° ì˜ˆë³´ë¥¼ ì°¾ì•„ë´…ë‹ˆë‹¤. ë‚ ì”¨ì— ë”°ë¼ ê·¸ë‚  ì…ì„ ì˜·ì„ ê³ ë¥´ê³ , ê°€ì ¸ê°ˆ ë¬¼ê±´ì„ ì±™ê¸°ê³ , í•˜ë£¨ ê³„íšì„ ë°”ê¾¸ê¸°ë„ í•©ë‹ˆë‹¤. ì´ì²˜ëŸ¼ ë‚ ì”¨ëŠ” ìš°ë¦¬ ìƒí™œì˜ ê±°ì˜ ëª¨ë“  ë¶€ë¶„ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ë‚ ì”¨ê°€ ìš°ë¦¬ ìƒí™œì„ ì–´ë–»ê²Œ ë°”ê¾¸ëŠ”ì§€ ì—¬ëŸ¬ ì¸¡ë©´ì—ì„œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì²«ì§¸, ë‚ ì”¨ëŠ” ìš°ë¦¬ê°€ ì…ëŠ” ì˜·ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤. ê¸°ì˜¨ì´ ë†’ê³  í–‡ë³•ì´ ê°•í•œ ì—¬ë¦„ì—ëŠ” ë•€ í¡ìˆ˜ê°€ ì˜ ë˜ëŠ” ì–‡ê³  ë°ì€ ìƒ‰ ì˜·ì„ ì…ìŠµë‹ˆë‹¤. ë°˜ë©´ ê¸°ì˜¨ì´ ëš ë–¨ì–´ì§€ëŠ” ê²¨ìš¸ì—ëŠ” ì²´ì˜¨ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ë‘êº¼ìš´ ì˜·ì„ ì—¬ëŸ¬ ê²¹ ê»´ì…ìŠµë‹ˆë‹¤. ë¹„ê°€ ì˜¬ ë•ŒëŠ” ìš°ì‚°ì´ë‚˜ ë¹„ì˜·ì„ ì¤€ë¹„í•˜ê³ , ë°”ëŒì´ ê°•í•œ ë‚ ì—ëŠ” ëª¨ìê°€ ë‚ ì•„ê°€ì§€ ì•Šë„ë¡ ì¡°ì‹¬í•©ë‹ˆë‹¤. ì´ì²˜ëŸ¼ ë‚ ì”¨ê°€ ë‹¬ë¼ì§€ë©´ ì‚¬ëŒë“¤ì´ ì…ëŠ” ì˜·ì˜ ì¢…ë¥˜ì™€ ë‘ê»˜ë„ ë‹¬ë¼ì§‘ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë‘˜ì§¸, ë‚ ì”¨ëŠ” ë†ì—…ê³¼ ì–´ì—…ì— í° ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ë†ì‚¬ë¥¼ ì§“ëŠ” ë†ë¶€ë“¤ì€ ì”¨ì•—ì„ ì‹¬ê±°ë‚˜ ìˆ˜í™•í•˜ëŠ” ì‹œê¸°ë¥¼ ë‚ ì”¨ì— ë§ì¶° ê²°ì •í•©ë‹ˆë‹¤. ë´„ì— ë”°ëœ»í•œ ë‚ ì”¨ê°€ ì´ì–´ì ¸ì•¼ ëª¨ê°€ ì˜ ìë¼ê³ , ì—¬ë¦„ì— ì ë‹¹í•œ ë¹„ê°€ ë‚´ë ¤ì•¼ ë²¼ê°€ íŠ¼íŠ¼í•˜ê²Œ ìëë‹ˆë‹¤. íƒœí’ì´ë‚˜ ê°€ë­„ì´ ë‹¥ì¹˜ë©´ í•œ í•´ ë†ì‚¬ë¥¼ ë§ì¹  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë°”ë‹¤ì—ì„œ ì¼í•˜ëŠ” ì–´ë¶€ë“¤ë„ ë§ˆì°¬ê°€ì§€ì…ë‹ˆë‹¤. íŒŒë„ê°€ ë†’ê±°ë‚˜ ì•ˆê°œê°€ ì§™ì€ ë‚ ì—ëŠ” ë°°ë¥¼ ë°”ë‹¤ì— ë‚´ë³´ë‚´ê¸° ì–´ë µìŠµë‹ˆë‹¤. ë‚ ì”¨ê°€ ì¢‹ì•„ì•¼ ì•ˆì „í•˜ê²Œ ë¬¼ê³ ê¸°ë¥¼ ì¡ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì–´ë¶€ë“¤ì€ ë‚ ì”¨ ì˜ˆë³´ë¥¼ ë§¤ìš° ì¤‘ìš”í•˜ê²Œ ìƒê°í•©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì…‹ì§¸, ë‚ ì”¨ëŠ” êµí†µê³¼ ì´ë™ì—ë„ ì˜í–¥ì„ ì¤ë‹ˆë‹¤. í­ì„¤ì´ ë‚´ë¦¬ë©´ ë„ë¡œê°€ ë¯¸ë„ëŸ¬ì›Œì ¸ ìë™ì°¨ ì‚¬ê³ ê°€ ëŠ˜ì–´ë‚˜ê³ , í•­ê³µê¸°ë‚˜ ê¸°ì°¨ê°€ ì§€ì—°ë˜ê±°ë‚˜ ì·¨ì†Œë˜ê¸°ë„ í•©ë‹ˆë‹¤. ì¥ë§ˆì²  ì§‘ì¤‘ í˜¸ìš°ì—ëŠ” í•˜ì²œì´ ë²”ëŒí•˜ê±°ë‚˜ ë„ë¡œê°€ ë¬¼ì— ì ê²¨ ì´ë™ ìì²´ê°€ ë¶ˆê°€ëŠ¥í•´ì§€ëŠ” ê²½ìš°ë„ ìƒê¹ë‹ˆë‹¤. íƒœí’ì´ ì˜¤ë©´ ê°•í’ ë•Œë¬¸ì— ë¹„í–‰ê¸°ê°€ ê²°í•­ë˜ê³ , í•­êµ¬ì— ì •ë°•í•´ ìˆë˜ ë°°ë“¤ë„ ì¶œí•­í•˜ì§€ ëª»í•©ë‹ˆë‹¤. ì´ì²˜ëŸ¼ ë‚ ì”¨ê°€ ë‚˜ë¹ ì§€ë©´ ì‚¬ëŒë“¤ì˜ ì´ë™ê³¼ ë¬¼ê±´ì˜ ìš´ì†¡ì´ ëª¨ë‘ ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë„·ì§¸, ë‚ ì”¨ëŠ” ì‚¬ëŒë“¤ì˜ ê±´ê°•ì—ë„ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ë´„ì² ì—ëŠ” ê±´ì¡°í•œ ë‚ ì”¨ì™€ ê°•í•œ ë°”ëŒ ë•Œë¬¸ì— í™©ì‚¬ì™€ ê½ƒê°€ë£¨ê°€ ë‚ ë ¤ ì•Œë ˆë¥´ê¸°ë‚˜ í˜¸í¡ê¸° ì§ˆí™˜ì´ ëŠ˜ì–´ë‚©ë‹ˆë‹¤. í•œì—¬ë¦„ í­ì—¼ì´ ì´ì–´ì§€ë©´ ì²´ì˜¨ ì¡°ì ˆì´ ì–´ë ¤ì›Œì ¸ ì—´ì‚¬ë³‘ì´ ìƒê¸°ê¸°ë„ í•˜ê³ , ìŒì‹ì´ ì‰½ê²Œ ìƒí•´ ì‹ì¤‘ë… ì‚¬ê³ ë„ ì¦ê°€í•©ë‹ˆë‹¤. ë°˜ëŒ€ë¡œ ê¸°ì˜¨ì´ ëš ë–¨ì–´ì§€ëŠ” í•œê²¨ìš¸ì—ëŠ” ë©´ì—­ë ¥ì´ ì•½í•´ì ¸ ê°ê¸°ë‚˜ ë…ê°ì— ê±¸ë¦¬ê¸° ì‰½ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ë‚ ì”¨ ë³€í™”ì— ë”°ë¼ ê±´ê°•ì„ ì±™ê¸°ëŠ” ë°©ë²•ë„ ë‹¬ë¼ì ¸ì•¼ í•©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë‹¤ì„¯ì§¸, ë‚ ì”¨ëŠ” ì‚¬ëŒë“¤ì´ ì—¬ê°€ë¥¼ ì¦ê¸°ëŠ” ë°©ì‹ì—ë„ ì˜í–¥ì„ ì¤ë‹ˆë‹¤. ë§‘ê³  ë”°ëœ»í•œ ë‚ ì—ëŠ” ê°€ì¡±ê³¼ í•¨ê»˜ ê³µì›ì„ ë‚˜ë“¤ì´í•˜ê±°ë‚˜ ìì „ê±°ë¥¼ íƒ€ëŠ” ì‚¬ëŒë“¤ì´ ë§ì•„ì§‘ë‹ˆë‹¤. ê²¨ìš¸ì— ëˆˆì´ ë§ì´ ìŒ“ì´ë©´ ìŠ¤í‚¤ì¥ì´ë‚˜ ëˆˆì°ë§¤ì¥ì„ ì°¾ëŠ” ì‚¬ëŒë“¤ë¡œ ë¶ì ì…ë‹ˆë‹¤. ë°˜ë©´ ë¹„ê°€ ì˜¤ê±°ë‚˜ ë¯¸ì„¸ ë¨¼ì§€ê°€ ì‹¬í•œ ë‚ ì—ëŠ” ì•¼ì™¸ í™œë™ì´ ì¤„ê³ , ì‹¤ë‚´ì—ì„œ ì¦ê¸¸ ìˆ˜ ìˆëŠ” í™œë™ì„ ì°¾ê²Œ ë©ë‹ˆë‹¤. ë‚ ì”¨ëŠ” ìš°ë¦¬ê°€ ì‰¬ê³  ë…¸ëŠ” ë°©ì‹ê¹Œì§€ ë°”ê¾¸ì–´ ë†“ìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì´ì²˜ëŸ¼ ë‚ ì”¨ëŠ” ì˜·ì°¨ë¦¼, ë†ì—…ê³¼ ì–´ì—…, êµí†µ, ê±´ê°•, ì—¬ê°€ì— ì´ë¥´ê¸°ê¹Œì§€ ìš°ë¦¬ ìƒí™œ ì „ë°˜ì— ê±¸ì³ ê¹Šì´ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‚ ì”¨ë¥¼ ë‹¨ìˆœíˆ ë§‘ê³  íë¦¬ê³ ì˜ ë¬¸ì œë¡œë§Œ ë³¼ ê²ƒì´ ì•„ë‹ˆë¼, ìš°ë¦¬ ì‚¶ê³¼ í•¨ê»˜ ìˆ¨ ì‰¬ëŠ” ì¤‘ìš”í•œ í™˜ê²½ ì¡°ê±´ìœ¼ë¡œ ì´í•´í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 }
                    ]
                },
                {
                    type: 'seq',
                    keyword: 'ì§€ì¸µ',
                    title: 'ì§€ì¸µê³¼ í™”ì„ì˜ í˜•ì„±',
                    paragraphs: [
                        { text: "  ì‚°ì„ ê¹ì•„ ë§Œë“  ë„ë¡œ ì˜† ì ˆë²½ì´ë‚˜ ê°•ê°€ì˜ ë‚­ë– ëŸ¬ì§€ë¥¼ ìì„¸íˆ ì‚´í´ë³´ë©´, í™ê³¼ ëª¨ë˜, ìê°ˆì´ ì¸µì¸µì´ ìŒ“ì—¬ ì¤„ë¬´ëŠ¬ì²˜ëŸ¼ ë³´ì´ëŠ” ê²ƒì„ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì´ ë°”ë¡œ ì§€ì¸µì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  ê·¸ ì§€ì¸µ ì•ˆì—ì„œëŠ” ì•„ì£¼ ì˜¤ë˜ì „ì— ì‚´ì•˜ë˜ ìƒë¬¼ì˜ í”ì ì¸ í™”ì„ì´ ë°œê²¬ë˜ê¸°ë„ í•©ë‹ˆë‹¤. ì§€ì¸µê³¼ í™”ì„ì€ ì˜¤ëœ ì‹œê°„ì— ê±¸ì³ ë§Œë“¤ì–´ì§€ëŠ”ë°, ê·¸ ê³¼ì •ì„ ìˆœì„œëŒ€ë¡œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë¨¼ì €, ê°•ì´ë‚˜ ë°”ë‹¤ì— ëª¨ë˜ì™€ ìê°ˆ, ì§„í™ì´ ìŒ“ì´ê¸° ì‹œì‘í•©ë‹ˆë‹¤. ë¹„ê°€ ë‚´ë¦¬ë©´ ì‚°ê³¼ ë“¤ì— ìˆëŠ” í™ê³¼ ëŒì´ ê°•ë¬¼ì— ì“¸ë ¤ ë‚´ë ¤ì˜µë‹ˆë‹¤. ê°•ë¬¼ì˜ íë¦„ì´ ëŠë ¤ì§€ëŠ” ê°• í•˜ë¥˜ë‚˜ ë°”ë‹¤ì— ì´ë¥´ë©´ ì´ ë¬¼ì§ˆë“¤ì´ ë°”ë‹¥ì— ê°€ë¼ì•‰ì•„ ì¸µì¸µì´ ìŒ“ì…ë‹ˆë‹¤. ê°€ë³ê³  ê³ ìš´ ì§„í™ì€ ìœ„ìª½ì—, ë¬´ê²ê³  êµµì€ ìê°ˆì€ ì•„ë˜ìª½ì— ìŒ“ì´ë©´ì„œ ì„œë¡œ ë‹¤ë¥¸ ì„±ì§ˆì˜ ì¸µì´ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë‹¤ìŒìœ¼ë¡œ, ìƒë¬¼ì´ ì£½ì–´ í‡´ì ë¬¼ ì†ì— ë¬»í™ë‹ˆë‹¤. ê°•ì´ë‚˜ ë°”ë‹¤ì— ì‚´ë˜ ë¬¼ê³ ê¸°, ì¡°ê°œ, ë‚˜ë­‡ì ë“±ì˜ ìƒë¬¼ì´ ì£½ìœ¼ë©´ ë°”ë‹¥ìœ¼ë¡œ ê°€ë¼ì•‰ì•„ ëª¨ë˜ë‚˜ ì§„í™ ì†ì— ë¬»íˆê²Œ ë©ë‹ˆë‹¤. ìƒë¬¼ì˜ ëª¸ì´ ì™„ì „íˆ ì‚¬ë¼ì§€ê¸° ì „ì— í‡´ì ë¬¼ì´ ìœ„ë¥¼ ë®ì–´ì•¼ í™”ì„ì´ ë  ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§‘ë‹ˆë‹¤. ë”°ë¼ì„œ í™”ì„ì€ ìœ¡ì§€ë³´ë‹¤ ë¬¼ì†ì—ì„œ ë” ì˜ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ê·¸ë‹¤ìŒìœ¼ë¡œ, ì˜¤ëœ ì‹œê°„ì´ ì§€ë‚˜ë©´ì„œ í‡´ì ë¬¼ì´ ë‹¨ë‹¨í•œ ì•”ì„ìœ¼ë¡œ ë³€í•©ë‹ˆë‹¤. ëª¨ë˜ì™€ ì§„í™ì´ ê³„ì†í•´ì„œ ìœ„ì— ìŒ“ì´ë©´, ì•„ë˜ì— ìˆëŠ” ì¸µì€ ì—„ì²­ë‚œ ë¬´ê²Œì— ëˆŒë¦½ë‹ˆë‹¤. ì´ ì••ë ¥ìœ¼ë¡œ ì¸í•´ í‡´ì ë¬¼ ì‚¬ì´ì˜ ë¬¼ì´ ë¹ ì ¸ë‚˜ê°€ê³ , ì…ìë“¤ì´ ì„œë¡œ ë‹¨ë‹¨íˆ êµ³ì–´ í‡´ì ì•”ì´ ë©ë‹ˆë‹¤. ì´ ê³¼ì •ì€ ìˆ˜ë°±ë§Œ ë…„ì—ì„œ ìˆ˜ì²œë§Œ ë…„ì— ê±¸ì³ ì¼ì–´ë‚©ë‹ˆë‹¤. ìƒë¬¼ì˜ ë”±ë”±í•œ ë¶€ë¶„ì¸ ë¼ˆ, ê»ë°ê¸°, ì´ë¹¨ ë“±ì€ ì´ ì•”ì„ ì†ì—ì„œ ê´‘ë¬¼ë¡œ ì²œì²œíˆ ëŒ€ì²´ë˜ì–´ í™”ì„ì´ ë©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì´ì–´ì„œ, ë•…ì† ê¹Šì´ ìˆë˜ ì§€ì¸µì´ ì§€í‘œë©´ ê°€ê¹Œì´ë¡œ ì˜¬ë¼ì˜µë‹ˆë‹¤. ì˜¤ëœ ì„¸ì›” ë™ì•ˆ ì§€êµ¬ ë‚´ë¶€ì˜ í˜ì´ ì‘ìš©í•˜ë©´ì„œ ì§€ì¸µì´ íœ˜ì–´ì§€ê±°ë‚˜ ëŠì–´ì§€ê¸°ë„ í•˜ê³ , í™”ì‚° í™œë™ê³¼ ê°™ì€ ì§€ê° ë³€ë™ìœ¼ë¡œ ë•…ì´ ì†Ÿì•„ì˜¤ë¥´ê¸°ë„ í•©ë‹ˆë‹¤. ë³¸ë˜ ë¬¼ì†ì— ìŒ“ì˜€ë˜ ì§€ì¸µì´ ì´ëŸ¬í•œ ë³€í™”ë¥¼ ê±°ì³ ìœ¡ì§€ì˜ ì‚°ì´ë‚˜ ë“¤íŒì´ ë˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë§ˆì§€ë§‰ìœ¼ë¡œ, ì§€í‘œë©´ ê°€ê¹Œì´ ì˜¬ë¼ì˜¨ ì§€ì¸µì´ ê¹ì´ë©´ì„œ í™”ì„ì´ ë“œëŸ¬ë‚©ë‹ˆë‹¤. ì˜¤ëœ ì‹œê°„ ë™ì•ˆ ë¹—ë¬¼ê³¼ ë°”ëŒ, ê°•ë¬¼ì´ ì§€ì¸µì˜ í‘œë©´ì„ ì¡°ê¸ˆì”© ê¹ì•„ ëƒ…ë‹ˆë‹¤. ì´ë¥¼ í’í™”ì™€ ì¹¨ì‹ì´ë¼ê³  í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ë•…ì† ê¹Šì´ ìˆ¨ì–´ ìˆë˜ í™”ì„ì´ ì§€í‘œë©´ìœ¼ë¡œ ë‚˜ì˜¤ê²Œ ë©ë‹ˆë‹¤. ê³¼í•™ìë“¤ì€ ì´ë ‡ê²Œ ë“œëŸ¬ë‚œ í™”ì„ì„ ë°œêµ´í•˜ì—¬ ì˜¤ë˜ì „ ìƒë¬¼ì˜ ìƒê¹€ìƒˆ, í¬ê¸°, ì‚´ì•˜ë˜ í™˜ê²½ ë“±ì„ ë°í˜€ëƒ…ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì´ì²˜ëŸ¼ ì§€ì¸µê³¼ í™”ì„ì€ í‡´ì , ë§¤ëª°, ì•”ì„í™”, ì§€ê° ë³€ë™, ì¹¨ì‹ì´ë¼ëŠ” ê¸´ ê³¼ì •ì„ ê±°ì³ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤. ìš°ë¦¬ê°€ ë°•ë¬¼ê´€ì—ì„œ ë³´ëŠ” ê³µë£¡ í™”ì„ í•˜ë‚˜ì—ëŠ” ìˆ˜ì²œë§Œ ë…„ì˜ ì‹œê°„ì´ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤. ì§€ì¸µê³¼ í™”ì„ì€ ë‹¨ìˆœí•œ ëŒë©ì´ê°€ ì•„ë‹ˆë¼, ì§€êµ¬ì˜ ì˜¤ëœ ì—­ì‚¬ë¥¼ ê¸°ë¡í•œ ì†Œì¤‘í•œ ì¦ê±°ì…ë‹ˆë‹¤.", mainSentenceIndex: 0 }
                    ]
                },
                {
                    type: 'comp',
                    keyword: 'ê³ ì¥',
                    title: 'ì‚°ì§€ ê³ ì¥ê³¼ í‰ì•¼ ê³ ì¥',
                    paragraphs: [
                        { text: "  ìš°ë¦¬ë‚˜ë¼ëŠ” ì¢ì€ êµ­í†  ì•ˆì—ì„œë„ ì§€ì—­ë§ˆë‹¤ ìƒê¹€ìƒˆê°€ ë¬´ì²™ ë‹¤ë¦…ë‹ˆë‹¤. ê°•ì›ë„ì²˜ëŸ¼ ë†’ê³  í—˜í•œ ì‚°ì´ ë§ì€ ê³³ì´ ìˆëŠ”ê°€ í•˜ë©´, ì „ë¼ë„ì²˜ëŸ¼ ë„“ê³  í‰í‰í•œ ë“¤íŒì´ í¼ì³ì§„ ê³³ë„ ìˆìŠµë‹ˆë‹¤. ì´ì²˜ëŸ¼ ê³ ì¥ì˜ ì§€í˜•ì´ ë‹¤ë¥´ë©´ ê·¸ê³³ì— ì‚¬ëŠ” ì‚¬ëŒë“¤ì˜ ìƒí™œ ëª¨ìŠµë„ í¬ê²Œ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì‚°ì´ ë§ì€ ê³ ì¥ê³¼ í‰ì•¼ì´ ë„“ì€ ê³ ì¥ì€ ì–´ë–¤ ê³µí†µì ê³¼ ì°¨ì´ì ì´ ìˆëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë‘ ê³ ì¥ì˜ ê³µí†µì ì„ ë¨¼ì € ì‚´í´ë³´ë©´, ì‚°ì§€ ê³ ì¥ê³¼ í‰ì•¼ ê³ ì¥ ëª¨ë‘ ìì—°í™˜ê²½ì„ ì´ìš©í•˜ì—¬ ì‚¬ëŒë“¤ì´ ì‚¶ì„ ê¾¸ë ¤ ë‚˜ê°„ë‹¤ëŠ” ì ì—ì„œ ê°™ìŠµë‹ˆë‹¤. ë‘ ê³³ ëª¨ë‘ ë§ˆì„ê³¼ í•™êµ, ì‹œì¥ì´ ìˆê³ , ì£¼ë¯¼ë“¤ì´ ì„œë¡œ ë„ìš°ë©° ê³µë™ì²´ë¥¼ ì´ë£¨ê³  ì‚½ë‹ˆë‹¤. ë˜í•œ ê³„ì ˆì˜ ì˜í–¥ì„ ë°›ìœ¼ë©° ë´„ì— ì”¨ë¥¼ ë¿Œë¦¬ê³  ê°€ì„ì— ìˆ˜í™•í•˜ëŠ” ë†ì‚¬ì™€ ê´€ë ¨ëœ ìƒí™œì´ ì´ë£¨ì–´ì§„ë‹¤ëŠ” ê³µí†µì ë„ ìˆìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ê·¸ëŸ¬ë‚˜ ë•…ì˜ ìƒê¹€ìƒˆì— ë”°ë¼ ë‘ ê³ ì¥ì˜ ìƒí™œ ëª¨ìŠµì€ ì—¬ëŸ¬ ë©´ì—ì„œ ëšœë ·í•˜ê²Œ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ìš°ì„  ì£¼ìš” ì‚°ì—…ê³¼ ìƒì‚°ë¬¼ì´ ë‹¤ë¦…ë‹ˆë‹¤. ì‚°ì§€ ê³ ì¥ì—ì„œëŠ” ê²½ì‚¬ì§„ ë•…ì— ë°­ì„ ì¼êµ¬ì–´ ê°ì, ì˜¥ìˆ˜ìˆ˜, ë°°ì¶”ì²˜ëŸ¼ ì„œëŠ˜í•œ ë‚ ì”¨ì— ì˜ ìë¼ëŠ” ì‘ë¬¼ì„ ì£¼ë¡œ ì¬ë°°í•©ë‹ˆë‹¤. ìš¸ì°½í•œ ìˆ²ì—ì„œ ë‚˜ë¬´ë¥¼ ë² ê±°ë‚˜ ë²„ì„¯, ì‚°ë‚˜ë¬¼ì„ ì±„ì·¨í•˜ëŠ” ì¼ë„ í™œë°œí•©ë‹ˆë‹¤. ë°˜ë©´ í‰ì•¼ ê³ ì¥ì—ì„œëŠ” ë„“ê³  í‰í‰í•œ ë…¼ì—ì„œ ìŒ€ì„ ëŒ€ëŸ‰ìœ¼ë¡œ ì¬ë°°í•˜ê±°ë‚˜, ë¹„ë‹í•˜ìš°ìŠ¤ë¥¼ ì´ìš©í•´ ì±„ì†Œì™€ ê³¼ì¼ì„ ì‚¬ê³„ì ˆ ë‚´ë‚´ ìƒì‚°í•©ë‹ˆë‹¤. ë“¤íŒì´ ë„“ì–´ ê¸°ê³„ë¥¼ ì´ìš©í•œ ë†ì‚¬ë„ í›¨ì”¬ ìˆ˜ì›”í•©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ë‹¤ìŒìœ¼ë¡œ êµí†µê³¼ ë§ˆì„ì˜ í˜•íƒœê°€ ë‹¤ë¦…ë‹ˆë‹¤. ì‚°ì§€ ê³ ì¥ì€ í—˜í•œ ì‚°ê³¼ ê³„ê³¡ì´ ë§ì•„ ë„ë¡œë¥¼ ë†“ê¸° ì–´ë µê³ , ë§ˆì„ë“¤ì´ ê³¨ì§œê¸°ë§ˆë‹¤ í©ì–´ì ¸ ìˆëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ê³¼ê±°ì—ëŠ” ë§ˆì„ ì‚¬ì´ë¥¼ ì˜¤ê°€ëŠ” ê²ƒ ìì²´ê°€ í˜ë“  ì¼ì´ì—ˆê³ , ì§€ê¸ˆë„ êµ¬ë¶ˆêµ¬ë¶ˆí•œ ì‚°ê¸¸ì„ í•œì°¸ ë‹¬ë ¤ì•¼ ì´ì›ƒ ë§ˆì„ì— ë‹¿ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. ì´ì— ë¹„í•´ í‰ì•¼ ê³ ì¥ì€ ë•…ì´ í‰í‰í•´ ê¸¸ì„ ë‚´ê¸° ì‰¬ì›Œì„œ ë„ë¡œë§ì´ ì˜ ë°œë‹¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì‚¬ëŒê³¼ ë¬¼ìì˜ ì´ë™ì´ í¸ë¦¬í•˜ê¸° ë•Œë¬¸ì— í° ì‹œì¥ì´ë‚˜ ìƒì—… ì§€ì—­ì´ ë“¤ì–´ì„œê¸°ë„ ì‰½ìŠµë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì—¬ê°€ í™œë™ê³¼ ì¶•ì œ ë¬¸í™”ì—ì„œë„ ì°¨ì´ê°€ ë‚©ë‹ˆë‹¤. ì‚°ì§€ ê³ ì¥ì—ì„œëŠ” ë˜í”„íŒ…, ë“±ì‚°, ìŠ¤í‚¤, ëˆˆì°ë§¤ì²˜ëŸ¼ ì‚°ê³¼ ê³„ê³¡ì„ í™œìš©í•œ ì•¼ì™¸ í™œë™ê³¼ ì²´í—˜ì´ ë°œë‹¬í•´ ìˆìŠµë‹ˆë‹¤. ë†’ì€ ì‚°ê³¼ ë§‘ì€ ê³„ê³¡ì´ ê´€ê´‘ ìì›ì´ ë˜ì–´ ë§¤ë…„ ë§ì€ ë°©ë¬¸ê°ì´ ì°¾ì•„ì˜¤ê¸°ë„ í•©ë‹ˆë‹¤. ë°˜ë©´ í‰ì•¼ ê³ ì¥ì—ì„œëŠ” ë“œë„“ì€ ë…¼ë°­ì—ì„œ í¼ì³ì§€ëŠ” ë†ì´Œ ì²´í—˜ì´ë‚˜ ìˆ˜í™• ì¶•ì œê°€ ìœ ëª…í•©ë‹ˆë‹¤. ë“œë„“ì€ í‰ì•¼ë¥¼ ë°°ê²½ìœ¼ë¡œ í•œ ì—°ê½ƒ ì¶•ì œ, ë”¸ê¸° ì¶•ì œ, í™©ê¸ˆ ë“¤ë…˜ ì‚¬ì§„ ì´¬ì˜ í–‰ì‚¬ ê°™ì€ ë¬¸í™” í™œë™ì´ í™œë°œí•˜ê²Œ ì—´ë¦½ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ìƒí™œì˜ ì–´ë ¤ì›€ì´ë¼ëŠ” ì¸¡ë©´ì—ì„œë„ ë‘ ê³ ì¥ì€ ë‹¤ë¥¸ ë¬¸ì œë¥¼ ì•ˆê³  ìˆìŠµë‹ˆë‹¤. ì‚°ì§€ ê³ ì¥ì€ êµí†µì´ ë¶ˆí¸í•˜ê³  ì˜ë£Œ ì‹œì„¤ì´ë‚˜ ë¬¸í™” ì‹œì„¤ì— ì ‘ê·¼í•˜ê¸° ì–´ë ¤ìš´ ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. ë˜ ì‚°ì‚¬íƒœë‚˜ í­ì„¤ ê°™ì€ ìì—°ì¬í•´ì˜ í”¼í•´ë¥¼ ì…ê¸°ë„ í•©ë‹ˆë‹¤. í‰ì•¼ ê³ ì¥ì€ í™ìˆ˜ë‚˜ ê°€ë­„ìœ¼ë¡œ ë†ì‘ë¬¼ í”¼í•´ë¥¼ ì…ëŠ” ì¼ì´ ë§ê³ , ì¸êµ¬ê°€ ë„ì‹œë¡œ ë¹ ì ¸ë‚˜ê°€ë©° ë¹ˆ ë†ì´Œì´ ëŠ˜ì–´ë‚˜ëŠ” ë¬¸ì œë¥¼ ê²ªê¸°ë„ í•©ë‹ˆë‹¤.", mainSentenceIndex: 0 },
                        { text: "  ì´ì²˜ëŸ¼ ì‚°ì§€ ê³ ì¥ê³¼ í‰ì•¼ ê³ ì¥ì€ ìì—°í™˜ê²½ì„ ë°”íƒ•ìœ¼ë¡œ ìƒí™œí•œë‹¤ëŠ” ê³µí†µì ì„ ê°€ì§€ë©´ì„œë„, ì‚°ì—…, êµí†µ, ì—¬ê°€, ìƒí™œì˜ ì–´ë ¤ì›€ì— ì´ë¥´ê¸°ê¹Œì§€ ì—¬ëŸ¬ ë©´ì—ì„œ ì„œë¡œ ë‹¤ë¥¸ ëª¨ìŠµì„ ë³´ì…ë‹ˆë‹¤. ë‘ ê³ ì¥ì€ ì–´ëŠ ìª½ì´ ë” ë‚«ê³  ëª»í•˜ë‹¤ê³  í•  ìˆ˜ ì—†ìœ¼ë©°, ì €ë§ˆë‹¤ì˜ í™˜ê²½ì— ë§ê²Œ ë°œì „í•´ ì˜¨ ì†Œì¤‘í•œ ì‚¶ì˜ í„°ì „ì…ë‹ˆë‹¤. ì„œë¡œ ë‹¤ë¥¸ ê³ ì¥ì˜ ëª¨ìŠµì„ ì´í•´í•˜ê³  ì¡´ì¤‘í•˜ëŠ” íƒœë„ê°€ í•„ìš”í•©ë‹ˆë‹¤.", mainSentenceIndex: 0 }
                    ]
                }
            ]
        };

        /* [STATE & GLOBALS] ---------------------------------- */
        let AppState = {
            score: 0,
            quizIdx: 0,
            quizSelectedAnswer: -1,
            level: '',
            currentText: null,
            currentSentences: [],
            paragraphNumbers: [],
            nextParaNum: 1,
            foundMainSentences: 0,
            currentStep: 0,
            diagramItems: [],
            currentStructureType: '',
            userKeyword: '', // Step 1: Topic word
            selectedMarkers: [], // Step 3: Structural cues/markers
            hintLevel: 0, // 0: None, 1: Topic, 2: Main Sentences, 3: Markers
            userSummary: "", // Step 5 supplement: Overall summary
            reasonForStructure: "" // Step 4 supplement: Why this structure?
        };

        /* [UI HELPERS] --------------------------------------- */
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');

            // Layout Adjustments
            if (id === 'screen-game') {
                document.getElementById('global-progress').style.display = 'block';
                document.getElementById('game-stats').style.display = 'flex';
                document.getElementById('level-badge').style.display = 'inline-block';
            } else {
                document.getElementById('global-progress').style.display = 'none';
                if (id !== 'screen-quiz') { // Keep stats for quiz but maybe not badge
                    document.getElementById('level-badge').style.display = 'none';
                }
                if (id === 'screen-home' || id === 'screen-level' || id === 'screen-history') {
                    document.getElementById('game-stats').style.display = 'none';
                }
                if (id === 'screen-history') {
                    renderHistory();
                }
            }
        }

        function updateAvatar(mood) {
            const el = document.getElementById('avatar-display');
            if (mood === 'happy') el.innerText = 'ğŸ˜„';
            else if (mood === 'thinking') el.innerText = 'ğŸ¤”';
            else if (mood === 'excited') el.innerText = 'ğŸ¤©';
            else if (mood === 'sad') el.innerText = 'ğŸ˜¥';
            else el.innerText = 'ğŸ˜';

            el.style.animation = 'none';
            el.offsetHeight; /* trigger reflow */
            el.style.animation = 'bounce 0.5s';
        }

        function addScore(points) {
            AppState.score += points;
            const el = document.getElementById('score-display');
            animateValue(el, parseInt(el.innerText), AppState.score, 1000);
            updateAvatar('excited');
        }

        function showFeedback(msg, isGood, duration = 3000) {
            // Target any available feedback element
            const el = document.getElementById('step-feedback') ||
                document.getElementById('quiz-feedback') ||
                document.getElementById('game-feedback');

            if (!el) return;
            el.innerText = msg;
            el.className = 'feedback-msg ' + (isGood ? 'good' : 'bad');
            el.style.opacity = 1;

            // Ensure feedback is visible
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Auto hide after specified duration (0 means persistent)
            if (duration > 0) {
                setTimeout(() => {
                    if (el && el.innerText === msg) el.style.opacity = 0;
                }, duration);
            }
        }

        function clearFeedback() {
            const el = document.getElementById('step-feedback') ||
                document.getElementById('quiz-feedback') ||
                document.getElementById('game-feedback');
            if (el) el.style.opacity = 0;
        }

        /* [QUIZ LOGIC] --------------------------------------- */
        function renderQuiz() {
            const q = QuizData[AppState.quizIdx];
            AppState.quizSelectedAnswer = -1;
            const container = document.getElementById('quiz-container');
            const feedback = document.getElementById('quiz-feedback');
            const nextContainer = document.getElementById('quiz-next-btn-container');

            if (feedback) feedback.style.opacity = 0;
            if (nextContainer) nextContainer.style.display = 'none';

            if (q.type === 'short-answer') {
                container.innerHTML = `
                    <div class="selection-card" style="width:100%; text-align:left; cursor:default; padding:30px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span style="font-weight:bold; color:var(--primary); font-size:0.9rem;">ë¬¸í•­ 1 / ${QuizData.length}</span>
                            <div style="display:flex; gap:10px;">
                                <button class="action-btn secondary" style="opacity:0.5; cursor:not-allowed; padding:5px 15px; font-size:0.85rem;" disabled>ì´ì „</button>
                                <button class="action-btn secondary" style="padding:5px 15px; font-size:0.85rem;" onclick="nextQuiz()">ë‹¤ìŒ</button>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:25px;">
                            <h3 style="margin:0; color:var(--primary); line-height:1.4;">${q.q}</h3>
                            <div style="display:flex; gap:8px;">
                                ${q.graphicHint ? `<button class="action-btn secondary" style="width:auto; padding:8px 15px; font-size:0.85rem; background:#eff6ff; border:1px solid #3b82f6; color:#1e40af; white-space:nowrap;" onclick="showQuizHint('graphic')">ğŸ–¼ï¸ ê·¸ë¦¼ íŒíŠ¸</button>` : ''}
                                <button class="action-btn secondary" style="width:auto; padding:8px 15px; font-size:0.85rem; background:#f0fdf4; border:1px solid #22c55e; color:#166534; white-space:nowrap;" onclick="showQuizHint('initial')">ğŸ’¡ ì´ˆì„± íŒíŠ¸</button>
                            </div>
                        </div>
                        <div style="display:flex; gap:15px; margin-bottom:25px;">
                            <input type="text" class="quiz-short-input" placeholder="êµ¬ì¡° 1" onfocus="clearFeedback()" style="flex:1; padding:12px; border-radius:10px; border:2px solid #e2e8f0; font-size:1.1rem; text-align:center; transition:all 0.3s;">
                            <input type="text" class="quiz-short-input" placeholder="êµ¬ì¡° 2" onfocus="clearFeedback()" style="flex:1; padding:12px; border-radius:10px; border:2px solid #e2e8f0; font-size:1.1rem; text-align:center; transition:all 0.3s;">
                            <input type="text" class="quiz-short-input" placeholder="êµ¬ì¡° 3" onfocus="clearFeedback()" style="flex:1; padding:12px; border-radius:10px; border:2px solid #e2e8f0; font-size:1.1rem; text-align:center; transition:all 0.3s;">
                        </div>
                        <button id="quiz-submit-btn" class="action-btn" style="width:100%; transition:all 0.3s;" onclick="checkQuiz()">ì •ë‹µ ì œì¶œí•˜ê¸°</button>
                        <div id="quiz-hint-display" style="display:none; margin-top:20px; padding:15px; background:#f8fafc; border-radius:10px; border:1px solid #e2e8f0; text-align:center;"></div>
                    </div>
                `;
            } else if (q.type === 'drag-table') {
                const titles = q.items.map(it => ({ id: it.id, text: it.title, category: 'title' }));
                const descs = q.items.map(it => ({ id: it.id, text: it.desc, category: 'desc' }));
                const pool = [...titles, ...descs].sort(() => Math.random() - 0.5);

                container.innerHTML = `
                    <div class="selection-card" style="width:100%; cursor:default; padding:30px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span style="font-weight:bold; color:var(--primary); font-size:0.9rem;">ë¬¸í•­ 2 / ${QuizData.length}</span>
                            <div style="display:flex; gap:10px;">
                                <button class="action-btn secondary" style="padding:5px 15px; font-size:0.85rem;" onclick="prevQuiz()">ì´ì „</button>
                                <button class="action-btn secondary" style="opacity:0.5; cursor:not-allowed; padding:5px 15px; font-size:0.85rem;" disabled>ë‹¤ìŒ</button>
                            </div>
                        </div>
                        <h3 style="margin:0 0 25px 0; text-align:left; color:var(--primary); line-height:1.4;">${q.q}</h3>
                        
                        <table class="drag-quiz-table">
                            <thead>
                                <tr>
                                    <th style="width:25%;">ë„í•´ì¡°ì§ì (ê·¸ë¦¼)</th>
                                    <th style="width:30%;">êµ¬ì¡° ì´ë¦„</th>
                                    <th style="width:45%;">êµ¬ì¡°ì— ëŒ€í•œ ì„¤ëª…</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${q.items.map(item => `
                                    <tr data-row-id="${item.id}">
                                        <td>
                                            <div class="matching-img-container" style="background:white; border-radius:8px; padding:5px; height:90px; display:flex; align-items:center; justify-content:center; position:relative;">
                                                <img src="${item.graphic}" class="matching-img-small">
                                                <div class="zoom-icon-btn" onclick="zoomImage(event, '${item.graphic}')">ğŸ”</div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="quiz-drop-zone" data-category="title" ondragover="handleDragOver(event)" ondrop="handleDrop(event)" ondragleave="handleDragLeave(event)">
                                                <span style="color:#cbd5e1; font-size:0.85rem;">ì—¬ê¸°ì— ë“œë˜ê·¸</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="quiz-drop-zone" data-category="desc" ondragover="handleDragOver(event)" ondrop="handleDrop(event)" ondragleave="handleDragLeave(event)">
                                                <span style="color:#cbd5e1; font-size:0.85rem;">ì—¬ê¸°ì— ë“œë˜ê·¸</span>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>

                        <div style="display:flex; gap:20px; margin-top:30px;">
                            <div style="flex:1;">
                                <div style="font-weight:bold; color:var(--primary); font-size:0.9rem; margin-bottom:10px;">ğŸ·ï¸ êµ¬ì¡° ì´ë¦„</div>
                                <div class="draggable-pool" id="quiz-drag-pool-title" data-category="title" ondragover="handleDragOver(event)" ondrop="handleDropToPool(event)" style="min-height:100px; background:#f0f9ff; border:2px dashed #bae6fd;">
                                    ${pool.filter(p => p.category === 'title').map((p, i) => `
                                        <div class="draggable-item" draggable="true" id="drag-item-title-${i}" data-id="${p.id}" data-category="${p.category}" ondragstart="handleDragStart(event)">
                                            ${p.text}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            <div style="flex:1;">
                                <div style="font-weight:bold; color:var(--primary); font-size:0.9rem; margin-bottom:10px;">ğŸ“ êµ¬ì¡° ì„¤ëª…</div>
                                <div class="draggable-pool" id="quiz-drag-pool-desc" data-category="desc" ondragover="handleDragOver(event)" ondrop="handleDropToPool(event)" style="min-height:100px; background:#f0fdf4; border:2px dashed #bbf7d0;">
                                    ${pool.filter(p => p.category === 'desc').map((p, i) => `
                                        <div class="draggable-item" draggable="true" id="drag-item-desc-${i}" data-id="${p.id}" data-category="${p.category}" ondragstart="handleDragStart(event)">
                                            ${p.text}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>

                        <button id="quiz-submit-btn" class="action-btn" style="width:100%; margin-top:30px; transition:all 0.3s;" onclick="checkQuiz()">ì •ë‹µ ì œì¶œí•˜ê¸°</button>
                        <div id="quiz-hint-display" style="display:none; margin-top:20px; padding:15px; background:#f8fafc; border-radius:10px; border:1px solid #e2e8f0; text-align:center;"></div>
                    </div>
                `;
            } else if (q.type === 'matching-3way') {
                const titles = [...q.items].sort(() => Math.random() - 0.5);
                const graphics = [...q.items].sort(() => Math.random() - 0.5);
                const descs = [...q.items].sort(() => Math.random() - 0.5);

                container.innerHTML = `
                    <div class="selection-card" style="width:100%; cursor:default; padding:30px;">
                        <div style="margin-bottom:30px; border-bottom:1px solid #f1f5f9; padding-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                            <h3 style="margin:0; text-align:left; color:var(--primary); line-height:1.4;">${q.q}</h3>
                            <span style="font-size:0.85rem; color:#64748b;">(ì´ë¦„ â†’ ê·¸ë¦¼ â†’ ì„¤ëª… ìˆœì„œë¡œ í´ë¦­!)</span>
                        </div>
                        <div class="matching-container" id="matching-container">
                            <div class="matching-column" data-type="title">
                                <div style="font-size:0.85rem; font-weight:bold; color:#64748b; text-align:center; padding:10px; background:#f8fafc; border-radius:8px; margin-bottom:5px;">êµ¬ì¡° ì´ë¦„</div>
                                ${titles.map(item => `<div class="matching-item" data-id="${item.id}">${item.title}</div>`).join('')}
                            </div>
                            <div class="matching-column" data-type="graphic">
                                <div style="font-size:0.85rem; font-weight:bold; color:#64748b; text-align:center; padding:10px; background:#f8fafc; border-radius:8px; margin-bottom:5px;">êµ¬ì¡° ê·¸ë¦¼</div>
                                ${graphics.map(item => {
                    let content = item.graphic.endsWith('.png')
                        ? `<div class="matching-img-container">
                                             <img src="${item.graphic}" style="max-width:100%; max-height:70px; object-fit:contain; pointer-events:none;">
                                             <div class="zoom-icon-btn" onclick="zoomImage(event, '${item.graphic}')">ğŸ”</div>
                                           </div>`
                        : `<span style="font-size:2rem;">${item.graphic}</span>`;
                    return `<div class="matching-item" data-id="${item.id}">${content}</div>`;
                }).join('')}
                            </div>
                            <div class="matching-column" data-type="desc">
                                <div style="font-size:0.85rem; font-weight:bold; color:#64748b; text-align:center; padding:10px; background:#f8fafc; border-radius:8px; margin-bottom:5px;">êµ¬ì¡° ì„¤ëª…</div>
                                ${descs.map(item => `<div class="matching-item" data-id="${item.id}" style="font-size:0.85rem; padding:10px;">${item.desc}</div>`).join('')}
                            </div>
                        </div>
                        <button id="quiz-submit-btn" class="action-btn" style="width:100%; margin-top:15px; transition:all 0.3s;" onclick="checkQuiz()">ë§¤ì¹­ ì™„ë£Œ</button>
                        <div id="quiz-hint-display" style="display:none; margin-top:20px; padding:15px; background:#f8fafc; border-radius:10px; border:1px solid #e2e8f0; text-align:center;"></div>
                    </div>
                `;
                setupMatchingLogic();
            }
        }

        /* --- Drag and Drop Logic for Quiz --- */
        function handleDragStart(e) {
            clearFeedback();
            e.dataTransfer.setData("text/plain", e.target.id);
            e.target.classList.add('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            const zone = e.target.closest('.quiz-drop-zone') || e.target.closest('.draggable-pool');
            if (zone) zone.classList.add('hover');
        }

        function handleDragLeave(e) {
            const zone = e.target.closest('.quiz-drop-zone') || e.target.closest('.draggable-pool');
            if (zone) zone.classList.remove('hover');
        }

        function handleDrop(e) {
            e.preventDefault();
            const zone = e.target.closest('.quiz-drop-zone');
            if (!zone) return;
            zone.classList.remove('hover');

            const id = e.dataTransfer.getData("text/plain");
            const draggableElement = document.getElementById(id);
            if (!draggableElement) return;

            // Check category match 
            const itemCat = draggableElement.dataset.category;
            const zoneCat = zone.dataset.category;

            if (itemCat !== zoneCat) {
                showFeedback("ì•Œë§ì€ ì¹¸ì— ë„£ì–´ì£¼ì„¸ìš”! ğŸ˜‰", false);
                draggableElement.classList.remove('dragging');
                return;
            }

            // If zone already has an item, return that item to pool
            const existingItem = zone.querySelector('.draggable-item');
            if (existingItem) {
                const targetPoolId = `quiz-drag-pool-${existingItem.dataset.category}`;
                const pool = document.getElementById(targetPoolId);
                if (pool) pool.appendChild(existingItem);
            }

            zone.innerHTML = '';
            zone.appendChild(draggableElement);
            zone.classList.add('filled');
            draggableElement.classList.remove('dragging');
        }

        function handleDropToPool(e) {
            e.preventDefault();
            const pool = e.target.closest('.draggable-pool');
            if (!pool) return;
            pool.classList.remove('hover');

            const id = e.dataTransfer.getData("text/plain");
            const draggableElement = document.getElementById(id);
            if (!draggableElement) return;

            // Strict category check for pools
            if (pool.dataset.category && pool.dataset.category !== draggableElement.dataset.category) {
                showFeedback("ì•Œë§ì€ ë°•ìŠ¤ì— ë„£ì–´ì£¼ì„¸ìš”! ğŸ˜‰", false);
                draggableElement.classList.remove('dragging');
                return;
            }

            pool.appendChild(draggableElement);
            draggableElement.classList.remove('dragging');

            // Find old zone and mark as empty
            document.querySelectorAll('.quiz-drop-zone').forEach(z => {
                if (z.children.length === 0) {
                    z.classList.remove('filled');
                    z.innerHTML = `<span style="color:#cbd5e1; font-size:0.85rem;">ì—¬ê¸°ì— ë“œë˜ê·¸</span>`;
                }
            });
        }

        let matchedGroupOrder = 0; // To assign colors in order
        function setupMatchingLogic() {
            matchingSet = { title: null, graphic: null, desc: null };
            matchedGroupOrder = 0; // Reset counter
            const items = document.querySelectorAll('.matching-item');

            items.forEach(item => {
                item.onclick = () => {
                    clearFeedback();
                    if (item.classList.contains('matched')) return;

                    const type = item.parentElement.dataset.type;
                    const id = item.dataset.id;

                    // Sequence Enforcement: title -> graphic -> desc
                    if (type === 'title') {
                        document.querySelectorAll('.matching-column[data-type="title"] .matching-item').forEach(el => el.classList.remove('selected'));
                        document.querySelectorAll('.matching-column[data-type="graphic"] .matching-item').forEach(el => el.classList.remove('selected'));
                        document.querySelectorAll('.matching-column[data-type="desc"] .matching-item').forEach(el => el.classList.remove('selected'));

                        item.classList.add('selected');
                        matchingSet = { title: id, graphic: null, desc: null };
                    }
                    else if (type === 'graphic') {
                        if (!matchingSet.title) {
                            showFeedback("ë¨¼ì € 'êµ¬ì¡° ì´ë¦„'ì„ ì„ íƒí•´ì£¼ì„¸ìš”! ğŸ˜‰", false);
                            return;
                        }
                        document.querySelectorAll('.matching-column[data-type="graphic"] .matching-item').forEach(el => el.classList.remove('selected'));
                        document.querySelectorAll('.matching-column[data-type="desc"] .matching-item').forEach(el => el.classList.remove('selected'));

                        item.classList.add('selected');
                        matchingSet.graphic = id;
                        matchingSet.desc = null;
                    }
                    else if (type === 'desc') {
                        if (!matchingSet.graphic) {
                            showFeedback("ê·¸ ë‹¤ìŒ 'êµ¬ì¡° ê·¸ë¦¼'ì„ ì„ íƒí•´ì£¼ì„¸ìš”! ğŸ˜‰", false);
                            return;
                        }
                        item.classList.add('selected');
                        matchingSet.desc = id;

                        // Check triplet completeness
                        if (matchingSet.title === matchingSet.graphic && matchingSet.graphic === matchingSet.desc) {
                            // MATCH!
                            const tripletId = matchingSet.title;
                            const groupClass = `group-${matchedGroupOrder}`;
                            matchedGroupOrder++;

                            document.querySelectorAll(`.matching-item[data-id="${tripletId}"]`).forEach(el => {
                                el.classList.remove('selected');
                                el.classList.add('matched', groupClass);
                            });
                            showFeedback("ì •í™•í•œ ì—°ê²°ì…ë‹ˆë‹¤! ì˜í•˜ì…¨ì–´ìš”. ğŸ‘", true);
                            matchingSet = { title: null, graphic: null, desc: null };

                            // If all 3 matched, sort them nicely and SHOW NEXT
                            if (document.querySelectorAll('.matching-item.matched').length === 9) {
                                setTimeout(sortMatchedItems, 500);
                                setTimeout(() => {
                                    const submitBtn = document.getElementById('quiz-submit-btn');
                                    if (submitBtn) submitBtn.style.display = 'none'; // Hide the "ë§¤ì¹­ ì™„ë£Œ" button

                                    const nextBtn = document.getElementById('quiz-next-btn-container');
                                    if (nextBtn) {
                                        nextBtn.innerHTML = `<button class="action-btn pulse" onclick="nextQuiz()" style="width:100%; max-width:480px; padding:25px; font-size:1.4rem; background:var(--primary-dark); box-shadow:0 8px 25px rgba(0,0,0,0.15); border-radius:15px; border:none; color:white; font-weight:bold; cursor:pointer;">ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°€ê¸° â”</button>`;
                                        nextBtn.style.display = 'block';
                                        nextBtn.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                    }
                                }, 1000);
                            }
                        } else {
                            // MISMATCH
                            showFeedback("ì•—, ì„œë¡œ ì–´ìš¸ë¦¬ì§€ ì•ŠëŠ” ì§ì´ì—ìš”. ë‹¤ì‹œ í•œë²ˆ ì œëª©ë¶€í„° ê³¨ë¼ë³¼ê¹Œìš”? ğŸ¤”", false);
                            setTimeout(() => {
                                document.querySelectorAll('.matching-item.selected').forEach(el => el.classList.remove('selected'));
                                matchingSet = { title: null, graphic: null, desc: null };
                            }, 1000);
                        }
                    }
                };
            });
        }

        function sortMatchedItems() {
            const container = document.getElementById('matching-container');
            if (!container) return;

            const columns = container.querySelectorAll('.matching-column');
            const targetOrder = ['enum', 'seq', 'comp'];

            columns.forEach(col => {
                const header = col.firstElementChild; // The "êµ¬ì¡° ì´ë¦„", etc. div
                const items = Array.from(col.querySelectorAll('.matching-item'));

                // Sort by target order
                items.sort((a, b) => {
                    return targetOrder.indexOf(a.dataset.id) - targetOrder.indexOf(b.dataset.id);
                });

                // Clear and re-append
                col.innerHTML = '';
                col.appendChild(header);
                items.forEach(item => col.appendChild(item));
            });
        }

        function zoomImage(e, src) {
            if (e) e.stopPropagation();
            const modal = document.getElementById('image-zoom-modal');
            const img = document.getElementById('zoomed-image');
            img.src = src;
            modal.style.display = 'flex';
        }

        function showQuizHint(type) {
            const q = QuizData[AppState.quizIdx];
            const display = document.getElementById('quiz-hint-display');
            if (!display) return;

            display.style.display = 'block';
            if (type === 'initial') {
                display.innerHTML = `<div style="color:var(--primary); font-weight:bold;">ğŸ’¡ ì´ˆì„± íŒíŠ¸: ${q.initialHints || "íŒíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤."}</div>`;
            } else if (type === 'graphic') {
                display.innerHTML = `<div style="color:var(--primary); font-weight:bold; margin-bottom:5px;">ğŸ–¼ï¸ ê·¸ë¦¼ íŒíŠ¸</div>${q.graphicHint || "ì´ë¯¸ì§€ ì˜ˆì‹œê°€ ì—†ìŠµë‹ˆë‹¤."}`;
            }
        }

        function checkQuiz() {
            const q = QuizData[AppState.quizIdx];
            let isCorrect = false;
            const submitBtn = document.getElementById('quiz-submit-btn');
            let feedbackMsg = "í‹€ë ¸ìŠµë‹ˆë‹¤. í•´ë‹¹ ë‚´ìš©ì„ ì²´í¬í•˜ë©° ë‹¤ì‹œ ìƒê°í•´ ë³´ì„¸ìš”. ğŸ¤”"; // ê¸°ë³¸ ì˜¤ë‹µ ë©”ì‹œì§€

            if (q.type === 'short-answer') {
                const inputEls = Array.from(document.querySelectorAll('.quiz-short-input'));
                let correctInBox = 0;
                let usedAnswersIndices = [];
                let incorrectInputs = [];

                inputEls.forEach(el => {
                    const val = el.value.trim();
                    if (val === "") return;

                    let matchedIdx = -1;

                    // Find if any answer matches and hasn't been used yet
                    for (let i = 0; i < q.answers.length; i++) {
                        if (usedAnswersIndices.includes(i)) continue;

                        const ans = q.answers[i];
                        let isMatch = false;

                        if (ans.includes(',')) {
                            const subAns = ans.split(',');
                            isMatch = subAns.every(sa => val.includes(sa));
                        } else {
                            isMatch = val.includes(ans);
                        }

                        if (isMatch) {
                            matchedIdx = i;
                            break;
                        }
                    }

                    if (matchedIdx !== -1) {
                        el.style.borderColor = "#22c55e";
                        el.style.backgroundColor = "#f0fdf4";
                        correctInBox++;
                        usedAnswersIndices.push(matchedIdx);
                    } else {
                        el.style.borderColor = "#ef4444";
                        el.style.backgroundColor = "#fef2f2";
                        incorrectInputs.push(val);
                    }
                });

                isCorrect = (correctInBox === q.answers.length);
                if (isCorrect) {
                    feedbackMsg = "ì •ë‹µì…ë‹ˆë‹¤! ğŸŒŸ ì„¤ëª…í•˜ëŠ” ê¸€ì˜ êµ¬ì¡° 3ê°€ì§€ë¥¼ ëª¨ë‘ ì˜ ì°¾ì•˜ìŠµë‹ˆë‹¤.";
                } else {
                    let parts = ["í‹€ë ¸ìŠµë‹ˆë‹¤."];
                    if (incorrectInputs.length > 0) {
                        parts.push(`'${incorrectInputs.join("', '")}'ì€(ëŠ”) í‹€ë¦° ë‹µì…ë‹ˆë‹¤.`);
                    }
                    if (correctInBox > 0) {
                        const foundNames = usedAnswersIndices.map(idx => q.answers[idx].replace(',', 'ì™€ ')).join(', ');
                        parts.push(`${foundNames} êµ¬ì¡°ëŠ” ì˜ ì°¾ì•˜ìŠµë‹ˆë‹¤.`);
                    }
                    parts.push("í•´ë‹¹ ë‚´ìš©ì„ ì²´í¬í•˜ë©° ë‹¤ì‹œ ìƒê°í•´ ë³´ì„¸ìš”! ğŸ¤”");
                    feedbackMsg = parts.join(" ");
                }
            } else if (q.type === 'drag-table') {
                let correctCount = 0;
                document.querySelectorAll('.drag-quiz-table tbody tr').forEach(row => {
                    const rowId = row.dataset.rowId;
                    const titleItem = row.querySelector('[data-category="title"] .draggable-item');
                    const descItem = row.querySelector('[data-category="desc"] .draggable-item');

                    if (titleItem && titleItem.dataset.id === rowId) correctCount++;
                    if (descItem && descItem.dataset.id === rowId) correctCount++;
                });

                isCorrect = (correctCount === 6);
                if (isCorrect) {
                    feedbackMsg = "ì •ë‹µì…ë‹ˆë‹¤! ğŸŒŸ ë„í•´ì¡°ì§ìì— ì•Œë§ì€ êµ¬ì¡°ì™€ ì„¤ëª…ì„ ëª¨ë‘ ì˜ ì—°ê²°í–ˆìŠµë‹ˆë‹¤.";
                } else {
                    feedbackMsg = "í‹€ë ¸ìŠµë‹ˆë‹¤. ë¹ˆì¹¸ì„ ëª¨ë‘ ì±„ìš°ê±°ë‚˜, í•´ë‹¹ ë‚´ìš©ì„ ì²´í¬í•˜ë©° ë‹¤ì‹œ ìƒê°í•´ ë³´ì„¸ìš”! ğŸ¤”";
                }
            } else if (q.type === 'matching-3way') {
                const matchedCount = document.querySelectorAll('.matching-column[data-type="title"] .matching-item.matched').length;
                isCorrect = (matchedCount === 3);
                if (isCorrect) {
                    feedbackMsg = "ì •ë‹µì…ë‹ˆë‹¤! ğŸŒŸ ëª¨ë“  êµ¬ì¡°ì™€ ê·¸ë¦¼, ì„¤ëª…ì„ ì™„ë²½í•˜ê²Œ ë§¤ì¹­í–ˆìŠµë‹ˆë‹¤.";
                } else {
                    feedbackMsg = `í‹€ë ¸ìŠµë‹ˆë‹¤. ì•„ì§ ë§¤ì¹­ë˜ì§€ ì•Šì€ êµ¬ì¡°ê°€ ìˆì–´ìš”. í•´ë‹¹ ë‚´ìš©ì„ ì²´í¬í•˜ë©° ë‹¤ì‹œ ìƒê°í•´ ë³´ì„¸ìš”. (${matchedCount}/3 ì™„ì„±) ğŸ¤”`;
                }
            }

            if (isCorrect) {
                showFeedback(feedbackMsg, true, 0); // Correct feedback stays persistent
                addScore(500);

                // transform submit button into next button for better UX
                if (submitBtn) {
                    submitBtn.innerHTML = "ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™í•˜ê¸° â”";
                    submitBtn.onclick = nextQuiz;
                    submitBtn.style.backgroundColor = "var(--primary-dark)";
                    submitBtn.style.fontSize = "1.3rem";
                    submitBtn.style.padding = "20px";
                    submitBtn.classList.add('pulse');
                }

                if (q.type === 'short-answer') {
                    const nextBtnContainer = document.getElementById('quiz-next-btn-container');
                    if (nextBtnContainer) {
                        nextBtnContainer.style.display = 'none'; // Ensure the separate next button container is hidden
                    }
                }

                updateAvatar('excited');
            } else {
                showFeedback(feedbackMsg, false);
                updateAvatar('thinking');
            }
        }


        function nextQuiz() {
            if (AppState.quizIdx < QuizData.length - 1) {
                AppState.quizIdx++;
                renderQuiz();
            } else {
                showScreen('screen-pledge');
            }
        }

        function prevQuiz() {
            if (AppState.quizIdx > 0) {
                AppState.quizIdx--;
                renderQuiz();
            }
        }

        function finishPledge() {
            const pledge = document.getElementById('pledge-input').value.trim();
            if (!pledge) {
                showFeedback("ë‚˜ì˜ ë‹¤ì§ì„ í•œ ì¤„ ì ì–´ë³´ì„¸ìš”! ğŸ˜Š", false);
                return;
            }
            showScreen('screen-level');
        }

        /* [GAME LOGIC] --------------------------------------- */
        function startGame(level) {
            AppState.level = level;
            AppState.score = 0;
            updateAvatar('thinking');

            // Random Text Selection
            const pool = GameData[level];
            const randomIndex = Math.floor(Math.random() * pool.length);
            AppState.currentText = JSON.parse(JSON.stringify(pool[randomIndex])); // Deep Copy

            // Badge
            const badge = document.getElementById('level-badge');
            badge.innerText = level === 'beginner' ? 'ì´ˆê¸‰' : level === 'intermediate' ? 'ì¤‘ê¸‰' : 'ìƒê¸‰';
            badge.className = 'badge ' + level;

            // Prepare Data for Analysis (Flatten Sentences & Split Tokens)
            AppState.currentSentences = [];
            AppState.currentText.paragraphs.forEach((para, pIdx) => {
                const sents = para.text.split(/(?<=[.?!])\s+/).filter(s => s.length > 0);
                sents.forEach((s, sIdx) => {
                    // Split into tokens for Step 1/3
                    const tokens = s.trim().split(/\s+/).map(t => ({
                        text: t,
                        isTopic: false,
                        isMarker: false
                    }));

                    AppState.currentSentences.push({
                        text: s.trim(),
                        tokens: tokens, // Word-level tokens
                        origPara: pIdx,
                        isMain: (sIdx === para.mainSentenceIndex),
                        isSelected: false // User choice
                    });
                });
            });

            // Reset Analysis State
            AppState.userKeyword = AppState.currentText.keyword; // Use data keyword
            AppState.selectedMarkers = [];
            AppState.diagramItems = [];
            AppState.currentStructureType = '';
            AppState.hintLevel = 0;
            updateHintStatus();

            setStep('structure');
            renderTextWithHints();
            showScreen('screen-game');

            // Update Header Title
            const titleEl = document.getElementById('game-title-step');
            if (titleEl) titleEl.innerText = AppState.currentText.title;
        }

        function setStep(content) {
            const container = document.getElementById('game-step-content');
            if (!container) return;

            if (content === 'structure') {
                container.innerHTML = `
                    <h4 style="margin-bottom:20px;">ğŸ¯ ê¸€ì˜ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ê°€ì¥ ì•Œë§ì€ êµ¬ì¡°ë¥¼ ì„ íƒí•˜ì„¸ìš”.</h4>
                    <div class="strategy-options" id="structure-selection-grid" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:15px;">
                        <div class="selection-card strategy-card" id="card-enum" onclick="selectStructure('enum')" style="padding:20px;">
                            <div style="font-size:2rem; margin-bottom:10px;">ğŸ“‹</div>
                            <div style="font-weight:bold; color:var(--primary);">ì—´ê±° êµ¬ì¡°</div>
                            <div style="font-size:0.85rem; color:#64748b; margin-top:5px;">íŠ¹ì§•ì´ë‚˜ ì¥ì  ë“±ì„ ë‚˜ì—´í•¨</div>
                        </div>
                        <div class="selection-card strategy-card" id="card-seq" onclick="selectStructure('seq')" style="padding:20px;">
                            <div style="font-size:2rem; margin-bottom:10px;">ğŸ•’</div>
                            <div style="font-weight:bold; color:var(--primary);">ìˆœì„œ êµ¬ì¡°</div>
                            <div style="font-size:0.85rem; color:#64748b; margin-top:5px;">ì‹œê°„ì´ë‚˜ ê³¼ì •ì˜ ìˆœì„œëŒ€ë¡œ ì„¤ëª…í•¨</div>
                        </div>
                        <div class="selection-card strategy-card" id="card-comp" onclick="selectStructure('comp')" style="padding:20px;">
                            <div style="font-size:2rem; margin-bottom:10px;">âš–ï¸</div>
                            <div style="font-weight:bold; color:var(--primary);">ë¹„êµì™€ ëŒ€ì¡°</div>
                            <div style="font-size:0.85rem; color:#64748b; margin-top:5px;">ê³µí†µì ê³¼ ì°¨ì´ì ì„ ìœ„ì£¼ë¡œ ì„¤ëª…í•¨</div>
                        </div>
                    </div>

                    <!-- Structure Selection Reasoning (Initially Hidden) -->
                    <div id="structure-reasoning-area" style="display:none; margin-top:30px; background:#fffbeb; border:2px solid #fde68a; border-radius:15px; padding:25px; box-shadow:0 4px 15px rgba(251,191,36,0.1);">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
                            <span style="font-size:1.5rem;">ğŸ¤”</span>
                            <h4 style="margin:0; color:#92400e;">ì™œ ì´ êµ¬ì¡°ë¥¼ ì„ íƒí–ˆëŠ”ì§€ ìì‹ ì˜ ìƒê°ì„ ì ì–´ë³´ì„¸ìš”.</h4>
                        </div>
                        <textarea id="structure-reason-input" 
                            placeholder="ì˜ˆ: 'ì²«ì§¸, ë‘˜ì§¸'ì™€ ê°™ì€ í‘œí˜„ì´ ì“°ì—¬ì„œ ì—´ê±° êµ¬ì¡°ë¥¼ ì„ íƒí–ˆì–´ìš”. / ê³µí†µì ê³¼ ì°¨ì´ì ì„ ì„¤ëª…í•˜ê³  ìˆì–´ì„œ ë¹„êµì™€ ëŒ€ì¡°ë¥¼ ê³¨ëì–´ìš”."
                            style="width:100%; height:100px; padding:15px; border-radius:10px; border:2px solid #fef3c7; font-family:inherit; font-size:1rem; resize:none; outline:none; margin-bottom:20px;"></textarea>
                        <button class="action-btn" onclick="confirmStructureReason()" style="width:100%; background:#f59e0b; color:white; border:none;">âœ… í™•ì¸í•˜ê³  ê·¸ë¦¼ ê·¸ë¦¬ê¸°</button>
                    </div>

                    <!-- Hint Section (Relocated between selection and diagram) -->
                    <div id="hint-section" style="background:#f8fafc; border:1px solid #e2e8f0; border-radius:12px; padding:15px; margin-top:30px;">
                        <div style="font-weight:bold; color:var(--primary); margin-bottom:10px; font-size:0.95rem;">ğŸ’¡ ë¶„ì„ íŒíŠ¸ ì„ íƒ</div>
                        <div id="hint-controls" style="display:flex; flex-direction:column; gap:8px;">
                            <div style="display:flex; gap:5px; flex-wrap:wrap;">
                                <button class="builder-btn" onclick="applyHint(2)"
                                    title="ê° ë¬¸ë‹¨ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ë‚´ìš©ì„ ë‹´ì€ ë¬¸ì¥ì´ì—ìš”."
                                    style="background:#dcfce7; border-color:#4ade80; flex:1; min-width:100px;">ì¤‘ì‹¬ ë¬¸ì¥ íŒíŠ¸</button>
                                <button class="builder-btn" onclick="applyHint(3)"
                                    title="ê¸€ì˜ êµ¬ì¡°(ì°¨ë¡€, íŠ¹ì§• ë“±)ë¥¼ ì•ˆë‚´í•˜ëŠ” ë‹¨ì–´ì˜ˆìš”."
                                    style="background:#ffedd5; border-color:#fb923c; flex:1; min-width:100px;">ê¸€ì˜ êµ¬ì¡°ë¥¼ ë“œëŸ¬ë‚´ëŠ” ë§(í‘œì§€ì–´) íŒíŠ¸</button>
                            </div>
                            <span id="hint-status" style="font-size:0.8rem; color:#64748b; font-weight:normal; min-height:1.2em;"></span>
                        </div>
                    </div>

                    <!-- Diagram Activity Area (Initially Hidden) -->
                    <div id="diagram-activity-area" style="display:none; margin-top:40px; border-top:2px dashed #e2e8f0; padding-top:30px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h4 style="margin:0;">ğŸ¯ êµ¬ì¡° ê·¸ë¦¼ì„ ì™„ì„±í•˜ê³  ë‚´ìš©ì„ ì •ë¦¬í•˜ì„¸ìš”.</h4>
                        </div>
                        <div class="diagram-canvas-container">
                            <div class="diagram-header" id="diagram-header" style="background:var(--primary); color:white; padding:10px; border-radius:8px; margin-bottom:15px; text-align:center; font-weight:bold;">êµ¬ì¡°ë„ ìƒì„± ì¤‘...</div>
                            <div id="diagram-canvas-final" class="diagram-canvas" style="border:2px dashed #cbd5e1; min-height:450px; display:flex; flex-direction:column; gap:15px; padding:15px; background:#f8fafc; border-radius:12px; overflow-y:auto; margin-bottom:30px;"></div>
                        </div>

                        <div id="summary-writing-section" style="margin-top:40px; border-top:2px solid #f1f5f9; padding-top:30px;">
                            <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
                                <span style="font-size:1.5rem;">âœï¸</span>
                                <h4 style="margin:0; color:var(--primary-dark);">5. ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©ê³¼ ì†Œê°ì„ ê°„ë‹¨í•˜ê²Œ ì ì–´ë³´ì„¸ìš”.</h4>
                            </div>
                            <p style="font-size:0.9rem; color:#64748b; margin-bottom:12px;">ì˜¤ëŠ˜ ê¸€ì„ ë¶„ì„í•˜ë©´ì„œ ë°°ìš´ ë‚´ìš©ì´ë‚˜ ëŠë‚€ ì ì„ ììœ ë¡­ê²Œ ì ì–´ë³¼ê¹Œìš”? (ê¸°ì¡´ì˜ ìš”ì•½ ëŒ€ì‹  ì†Œê°ì„ ì ì–´ì£¼ì„¸ìš”!)</p>
                            <textarea id="user-summary-input" 
                                placeholder="ì—¬ê¸°ì— ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©ê³¼ ì†Œê°ì„ ì…ë ¥í•˜ì„¸ìš”. ğŸ˜Š"
                                style="width:100%; min-height:180px; padding:20px; border-radius:12px; border:2px solid #e2e8f0; font-family:inherit; font-size:1rem; line-height:1.7; resize:vertical; outline:none; transition:border-color 0.2s; margin-bottom:25px;"></textarea>
                            <button class="action-btn" onclick="triggerGenerateReport()" style="width:100%; padding:20px; font-size:1.2rem; background:var(--primary-dark); box-shadow:0 10px 25px rgba(59,130,246,0.3);">ğŸ“‹ ë¶„ì„ ì™„ë£Œ! ë³´ê³ ì„œ ìƒì„±í•˜ê¸°</button>
                        </div>
                    </div>
                `;
            }
        }

        /* --- Hint-Based Interaction Helpers --- */
        function applyHint(level) {
            AppState.hintLevel = level;
            updateHintStatus();
            renderTextWithHints();

            const labels = ["", "ì£¼ì œ ë‚±ë§", "ì¤‘ì‹¬ ë¬¸ì¥", "ê¸€ì˜ êµ¬ì¡°ë¥¼ ë“œëŸ¬ë‚´ëŠ” ë§(í‘œì§€ì–´)"];
            showFeedback(`${labels[level]} íŒíŠ¸ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨`, true);
        }

        function updateHintStatus() {
            const statusEl = document.getElementById('hint-status');
            if (!statusEl) return;
            const labels = ["", "ì£¼ì œ ë‚±ë§ì´ ë…¸ë€ìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.", "ì¤‘ì‹¬ ë¬¸ì¥ì— ë°‘ì¤„ì´ í‘œì‹œë©ë‹ˆë‹¤.", "ê¸€ì˜ êµ¬ì¡°ë¥¼ ë“œëŸ¬ë‚´ëŠ” ë§(í‘œì§€ì–´)ì— í…Œë‘ë¦¬ê°€ í‘œì‹œë©ë‹ˆë‹¤."];
            let text = AppState.hintLevel > 0 ? `í™œì„±í™”: ${labels[AppState.hintLevel]}` : "";

            if (AppState.hintLevel === 3) {
                text += "\nâš ï¸ ë™ì¼í•œ í‘œì§€ì–´ê°€ ì—¬ëŸ¬ ê°€ì§€ ê¸€ì˜ êµ¬ì¡°ì—ì„œ ê³µí†µì ìœ¼ë¡œ ì“°ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë‹¨ì–´ ìì²´ì— ì˜ì¡´í•˜ê¸°ë³´ë‹¤ ì•ë’¤ ë‚´ìš©ì„ íŒŒì•…í•˜ì—¬ êµ¬ì¡°ë¥¼ ìµœì¢… íŒë‹¨í•˜ì„¸ìš”.";
            }
            statusEl.innerText = text;
            statusEl.style.whiteSpace = 'pre-wrap';
        }

        function renderTextWithHints() {
            const container = document.getElementById('text-panel');
            if (!container) return;
            container.innerHTML = '';
            container.style.lineHeight = '2';
            container.style.fontSize = '1.15rem';

            let currentParaDiv = null;
            AppState.currentSentences.forEach((s, sIdx) => {
                // Paragraph Separation
                if (currentParaDiv === null || (sIdx > 0 && s.origPara !== AppState.currentSentences[sIdx - 1].origPara)) {
                    currentParaDiv = document.createElement('div');
                    currentParaDiv.style.marginBottom = '25px';
                    currentParaDiv.style.textIndent = '1.5rem';
                    container.appendChild(currentParaDiv);
                }

                const sentenceSpan = document.createElement('span');
                sentenceSpan.className = 'canvas-sentence';

                // Hint Level 2: Highlight Main Sentences
                if (AppState.hintLevel === 2 && s.isMain) {
                    sentenceSpan.classList.add('selected');
                }

                s.tokens.forEach((t, tIdx) => {
                    const tokenSpan = document.createElement('span');
                    tokenSpan.className = 'canvas-token';
                    tokenSpan.innerText = t.text;
                    tokenSpan.style.pointerEvents = 'none'; // Passive viewing in this mode

                    // Hint Level 1: Topic Highlight
                    if (AppState.hintLevel === 1 && t.text === AppState.currentText.keyword) {
                        tokenSpan.classList.add('topic');
                    }

                    // Hint Level 3: Marker Highlight
                    if (AppState.hintLevel === 3) {
                        const markers = ["ì²«ì§¸", "ë‘˜ì§¸", "ì…‹ì§¸", "ë¨¼ì €", "ë‹¤ìŒìœ¼ë¡œ", "ê·¸ë‹¤ìŒìœ¼ë¡œ", "ë§ˆì§€ë§‰ìœ¼ë¡œ", "ë°˜ë©´", "ê³µí†µì ", "ì°¨ì´ì ", "í•˜ì§€ë§Œ", "ë˜í•œ", "ì´ì²˜ëŸ¼", "ì´ì™€ ë‹¬ë¦¬", "ê°™ì§€ë§Œ", "ë‹¤ë¦…ë‹ˆë‹¤"];
                        const cleanToken = t.text.replace(/[.?!,]/g, '');
                        if (markers.some(m => cleanToken.includes(m))) {
                            tokenSpan.classList.add('marker');
                        }
                    }

                    sentenceSpan.appendChild(tokenSpan);
                    if (tIdx < s.tokens.length - 1) {
                        sentenceSpan.appendChild(document.createTextNode(' '));
                    }
                });

                currentParaDiv.appendChild(sentenceSpan);
                currentParaDiv.appendChild(document.createTextNode(' '));
            });
        }

        function selectStructure(type) {
            AppState.currentStructureType = type;

            // UI Feedback
            document.querySelectorAll('.strategy-card').forEach(c => c.classList.remove('selected'));
            const selectedCard = document.getElementById('card-' + type);
            if (selectedCard) selectedCard.classList.add('selected');

            // Show Reasoning Area
            const reasoningArea = document.getElementById('structure-reasoning-area');
            if (reasoningArea) {
                reasoningArea.style.display = 'block';
                setTimeout(() => reasoningArea.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
            }

            updateAvatar('happy');
        }

        function confirmStructureReason() {
            const reason = document.getElementById('structure-reason-input').value.trim();
            if (!reason) {
                showFeedback("ì„ íƒí•œ ì´ìœ ë¥¼ í•œ ì¤„ë§Œ ì ì–´ì£¼ì„¸ìš”! ğŸ˜Š", false);
                return;
            }
            AppState.reasonForStructure = reason;

            // Show Diagram Building area
            const activityArea = document.getElementById('diagram-activity-area');
            if (activityArea) {
                activityArea.style.display = 'block';
                setTimeout(() => activityArea.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
            }

            setupStep5();
            showFeedback("ì¢‹ì€ ìƒê°ì´ì—ìš”! ì´ì œ ê·¸ë¦¼ì„ ì™„ì„±í•´ë³¼ê¹Œìš”? âœ¨", true);
        }

        /* --- Sidebar Navigation Logic --- */
        function goToActivityStep(n) {
            if (n === 1) {
                applyHint(0); // Reset hints for step 1
                updateSidebarHighlight(1);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (n === 2) {
                applyHint(2);
            } else if (n === 3) {
                applyHint(3);
            } else if (n === 4) {
                const target = document.getElementById('structure-selection-grid');
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    updateSidebarHighlight(4);
                }
            } else if (n === 5) {
                const area = document.getElementById('diagram-activity-area');
                if (area && area.style.display !== 'none') {
                    area.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    updateSidebarHighlight(5);
                } else {
                    showFeedback("ë¨¼ì € ê¸€ì˜ êµ¬ì¡°(4ë‹¨ê³„)ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”! ğŸ˜Š", false);
                }
            }
        }

        function updateSidebarHighlight(n) {
            document.querySelectorAll('.side-tab').forEach(tab => tab.classList.remove('active'));
            const activeTab = document.querySelector(`.side-tab.step-${n}`);
            if (activeTab) activeTab.classList.add('active');
        }

        function checkStep5() {
            // Validate diagram builder content (contenteditable divs)
            const items = document.querySelectorAll('.structure-box.sub');
            let filledCount = 0;
            items.forEach(el => {
                const text = el.innerText.trim();
                // If user didn't change placeholder or left it blank/very short
                if (text.length > 3 && !text.includes("ì…ë ¥í•˜ì„¸ìš”") && !text.includes("ë‹¨ê³„") && !text.includes("íŠ¹ì§•") && !text.includes("ê³µí†µì ")) {
                    filledCount++;
                }
            });

            if (filledCount < Math.max(1, items.length / 2)) {
                showFeedback("êµ¬ì¡°ë„ì˜ ë‚´ìš©ì„ ì¡°ê¸ˆ ë” ìì„¸íˆ ì±„ì›Œì£¼ì„¸ìš”! âœï¸", false);
                return false;
            }

            return true;
        }

        async function triggerGenerateReport() {
            if (!checkStep5()) return;

            const overlay = document.getElementById('report-loading-overlay');
            const bar = document.getElementById('report-loading-bar');
            const mainText = document.getElementById('loading-main-text');
            const subText = document.getElementById('loading-sub-text');

            overlay.style.display = 'flex';

            const steps = [
                { prg: 30, main: "ë°ì´í„° ë¶„ì„ ì¤‘...", sub: "ê¸€ì˜ êµ¬ì¡°ì™€ ì£¼ì œë¥¼ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤." },
                { prg: 60, main: "ë„í•´ì¡°ì§ì ìƒì„± ì¤‘...", sub: "ë¶„ì„í•œ ë‚´ìš©ì„ ì‹œê°í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤." },
                { prg: 90, main: "ë³´ê³ ì„œ ë ˆì´ì•„ì›ƒ êµ¬ì„± ì¤‘...", sub: "ë‚˜ë§Œì˜ ë©‹ì§„ ë¶„ì„ ë³´ê³ ì„œë¥¼ ë§Œë“­ë‹ˆë‹¤." },
                { prg: 100, main: "ì™„ë£Œ!", sub: "ì ì‹œ í›„ ë³´ê³ ì„œê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤." }
            ];

            let currentStep = 0;
            const animate = () => {
                if (currentStep >= steps.length) {
                    setTimeout(() => {
                        overlay.style.display = 'none';
                        finishGame(true); // Call with isInstant = true
                    }, 300);
                    return;
                }

                const s = steps[currentStep];
                bar.style.width = s.prg + '%';
                mainText.innerText = s.main;
                subText.innerText = s.sub;

                currentStep++;
                setTimeout(animate, 400); // Faster speed (400ms)
            };

            animate();
        }

        /* --- Step 5: Diagram Builder --- */
        function setupStep5() {
            // Initialize diagram items based on structure type
            const type = AppState.currentStructureType;
            if (type === 'enum') {
                AppState.diagramItems = ["íŠ¹ì§• 1", "íŠ¹ì§• 2", "íŠ¹ì§• 3"];
            } else if (type === 'seq') {
                AppState.diagramItems = ["1ë‹¨ê³„", "2ë‹¨ê³„", "3ë‹¨ê³„"];
            } else if (type === 'comp') {
                // Comparison: Multi-region object for blocks (Unified terminology)
                AppState.diagramItems = {
                    headers: { left: "ëŒ€ìƒ 1 ì…ë ¥", center: "ê³µí†µì ", right: "ëŒ€ìƒ 2 ì…ë ¥" },
                    left: ["ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"],
                    center: ["ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"],
                    right: ["ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"]
                };
            }
            renderDiagram();
        }

        function clearPlaceholder(el) {
            const val = el.innerText.trim();
            const placeholders = [
                "ë‚´ìš© ì…ë ¥", "íŠ¹ì§• 1", "íŠ¹ì§• 2", "íŠ¹ì§• 3",
                "1ë‹¨ê³„", "2ë‹¨ê³„", "3ë‹¨ê³„", "4ë‹¨ê³„", "5ë‹¨ê³„",
                "ëŒ€ìƒ 1 ì…ë ¥", "ëŒ€ìƒ 2 ì…ë ¥", "ê³µí†µì ", "ê³µí†µì  ì…ë ¥",
                "ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
            ];
            if (placeholders.includes(val)) {
                el.innerText = "";
            }
        }

        function renderDiagram() {
            const container = document.getElementById('diagram-canvas-final');
            const type = AppState.currentStructureType;
            if (!container || !type) return;

            // Header update (Focus on Topic)
            const header = document.getElementById('diagram-header');
            if (header) {
                header.innerHTML = `
                    <div style="font-size: 1.8rem; margin-bottom: 5px;">${AppState.currentText.title}</div>
                    <div style="font-size: 0.9rem; font-weight: normal; opacity: 0.9;">
                        ${type === 'enum' ? 'ì—´ê±° êµ¬ì¡° ë¶„ì„' : type === 'seq' ? 'ìˆœì„œ êµ¬ì¡° ë¶„ì„' : 'ë¹„êµì™€ ëŒ€ì¡° ë¶„ì„'} (ë„í•´ì¡°ì§ì)
                    </div>
                `;
            }

            // Ensure we have items (Support both Array and Object states)
            const hasItems = Array.isArray(AppState.diagramItems) ?
                AppState.diagramItems.length > 0 :
                (type === 'comp' && AppState.diagramItems && typeof AppState.diagramItems === 'object');

            if (!hasItems) {
                setupStep5();
                return;
            }

            const mainSentenceText = AppState.currentSentences.find(s => s.isMain)?.text || "ì£¼ìš” ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.";

            let html = `
                <div class="structure-box main" style="background:#fff7ed; border:2px solid #fdba74; padding:20px; border-radius:12px; margin-bottom:15px; text-align:center; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
                    <div style="font-size:1.05rem; color:#9a3412; line-height:1.6; font-weight:600;">${mainSentenceText}</div>
                </div>
                <div style="text-align:center; font-size:1.8rem; margin-bottom:15px; color:#fdba74; animation: bounce 2s infinite;">â¬‡ï¸</div>
            `;

            if (type === 'enum') {
                html += `
                    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:12px;">
                        ${AppState.diagramItems.map((item, i) => `
                            <div class="structure-box-wrapper" style="position:relative;">
                                <button class="remove-box-btn" onclick="removeDiagramItem(${i})" style="position:absolute; top:-8px; right:-8px; background:#ef4444; color:white; border:none; border-radius:50%; width:22px; height:22px; font-size:14px; cursor:pointer; display:flex; align-items:center; justify-content:center; z-index:5; box-shadow:0 2px 4px rgba(0,0,0,0.1);">Ã—</button>
                                <div class="structure-box sub" contenteditable="true" oninput="updateDiagramItem(${i}, this.innerText)" onfocus="clearPlaceholder(this)" 
                                    style="background:white; border:1px solid #cbd5e1; padding:12px; border-radius:10px; min-height:80px; font-size:0.95rem; line-height:1.5; color:#334155; transition:all 0.2s;">${item}</div>
                            </div>
                        `).join('')}
                        <button class="add-box-btn" onclick="addDiagramItem()" 
                            style="border:2px dashed #cbd5e1; background:#f8fafc; border-radius:10px; padding:12px; cursor:pointer; min-height:80px; color:#64748b; font-weight:bold; transition:all 0.2s;">+ ìƒì ì¶”ê°€</button>
                    </div>
                `;
            } else if (type === 'seq') {
                // ... (Sequence logic keeps as is)
                html += `
                    <div style="display:flex; flex-direction:column; gap:10px; align-items:center; width:100%;">
                        ${AppState.diagramItems.map((item, i) => `
                            <div style="width:100%; display:flex; flex-direction:column; align-items:center;">
                                <div class="structure-box-wrapper" style="width:100%; position:relative; max-width:400px;">
                                    <button class="remove-box-btn" onclick="removeDiagramItem(${i})" style="position:absolute; top:-8px; right:-8px; background:#ef4444; color:white; border:none; border-radius:50%; width:22px; height:22px; font-size:14px; cursor:pointer; display:flex; align-items:center; justify-content:center; z-index:5;">Ã—</button>
                                    <div class="structure-box sub" contenteditable="true" oninput="updateDiagramItem(${i}, this.innerText)" onfocus="clearPlaceholder(this)" 
                                        style="background:white; border:1px solid #cbd5e1; padding:12px; border-radius:10px; width:100%; text-align:center; min-height:50px; font-size:0.95rem;">${item}</div>
                                </div>
                                ${i < AppState.diagramItems.length - 1 ? '<div style="font-size:1.2rem; color:#cbd5e1; margin:2px 0;">â¬‡ï¸</div>' : ''}
                            </div>
                        `).join('')}
                        <button class="add-box-btn" onclick="addDiagramItem()" 
                            style="border:2px dashed #cbd5e1; background:#f8fafc; border-radius:10px; padding:8px 30px; cursor:pointer; color:#64748b; font-weight:bold; margin-top:5px;">+ ë‹¨ê³„ ì¶”ê°€</button>
                    </div>
                `;
            } else if (type === 'comp') { // Comparison Chart (3 Columns)
                const headers = AppState.diagramItems.headers || { left: "ëŒ€ìƒ 1", center: "ê³µí†µì ", right: "ëŒ€ìƒ 2" };
                html += `
                    <div class="comp-chart-container">
                        <div class="comp-column left">
                            <div class="comp-column-header" contenteditable="true" oninput="updateCompHeader('left', this.innerText)" onfocus="clearPlaceholder(this)">${headers.left}</div>
                            ${renderCompRegion('left')}
                        </div>
                        <div class="comp-column center">
                            <div class="comp-column-header" contenteditable="true" oninput="updateCompHeader('center', this.innerText)" onfocus="clearPlaceholder(this)">${headers.center}</div>
                            ${renderCompRegion('center')}
                        </div>
                        <div class="comp-column right">
                            <div class="comp-column-header" contenteditable="true" oninput="updateCompHeader('right', this.innerText)" onfocus="clearPlaceholder(this)">${headers.right}</div>
                            ${renderCompRegion('right')}
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // Helper for rendering Comparison regions
        function renderCompRegion(reg) {
            const items = AppState.diagramItems[reg] || [];
            return `
                <div class="comp-block-list">
                    ${items.map((txt, idx) => `
                        <div class="structure-box-wrapper" style="width:100%; position:relative;">
                            <button class="remove-box-btn" onclick="removeCompItem('${reg}', ${idx})" style="position:absolute; top:-5px; right:-5px; background:#ef4444; color:white; border:none; border-radius:50%; width:18px; height:18px; font-size:12px; cursor:pointer; z-index:15;">Ã—</button>
                            <div class="structure-box sub" contenteditable="true" oninput="updateCompItem('${reg}', ${idx}, this.innerText)" onfocus="clearPlaceholder(this)" 
                                style="background:white; border:1px solid #cbd5e1; padding:8px; border-radius:8px; min-height:40px; font-size:0.85rem; width:100%; text-align:center;">${txt}</div>
                        </div>
                    `).join('')}
                    <button class="add-box-btn" onclick="addCompItem('${reg}')" 
                        style="border:1px dashed #cbd5e1; background:rgba(255,255,255,0.7); border-radius:8px; padding:6px 12px; font-size:0.8rem; cursor:pointer; color:#64748b; width:100%;">+ ì¶”ê°€</button>
                </div>
            `;
        }

        function addDiagramItem() {
            AppState.diagramItems.push("ë‚´ìš© ì…ë ¥");
            renderDiagram();
        }

        function removeDiagramItem(idx) {
            AppState.diagramItems.splice(idx, 1);
            renderDiagram();
        }

        function updateDiagramItem(idx, text) {
            AppState.diagramItems[idx] = text;
        }

        function addCompItem(reg) {
            if (!AppState.diagramItems[reg]) AppState.diagramItems[reg] = [];
            AppState.diagramItems[reg].push("ë‚´ìš© ì…ë ¥");
            renderDiagram();
        }

        function removeCompItem(reg, idx) {
            AppState.diagramItems[reg].splice(idx, 1);
            renderDiagram();
        }

        function updateCompHeader(reg, text) {
            if (!AppState.diagramItems.headers) AppState.diagramItems.headers = {};
            AppState.diagramItems.headers[reg] = text;
        }

        function updateCompItem(reg, idx, text) {
            AppState.diagramItems[reg][idx] = text;
        }

        function finishGame(isInstant = false) {
            if (isInstant) {
                showReport();
            } else {
                addScore(500);
                showFeedback("ëŒ€ë‹¨í•´ìš”! ê¸€ì˜ ì „ì²´ êµ¬ì¡°ë¥¼ ì™„ë²½í•˜ê²Œ ë¶„ì„í–ˆìŠµë‹ˆë‹¤. ğŸ†", true);
                setTimeout(() => showReport(), 2000);
            }
        }

        /* --- Report --- */
        function showReport() {
            showScreen('screen-report');
            document.getElementById('final-score-display').innerText = AppState.score;
            document.getElementById('report-level-text').innerText = document.getElementById('level-badge').innerText;
            document.getElementById('report-date').innerText = new Date().toLocaleString();

            // Text
            document.getElementById('report-text').innerHTML = AppState.currentText.paragraphs.map(p => {
                let pText = p.text;
                const keyword = AppState.currentText.keyword;
                if (pText.includes(keyword)) {
                    pText = pText.replace(new RegExp(keyword, 'g'), `<span style="background-color: #fef08a; font-weight:bold; border-radius: 4px; padding: 2px 4px;">${keyword}</span>`);
                }
                return `<p style="text-indent: 1.5rem; margin-bottom: 10px; line-height: 1.6;">${pText}</p>`;
            }).join('');



            // Details
            const structLabel = AppState.currentStructureType === 'enum' ? 'ì—´ê±° êµ¬ì¡°' :
                AppState.currentStructureType === 'seq' ? 'ìˆœì„œ êµ¬ì¡°' : 'ë¹„êµì™€ ëŒ€ì¡°';
            if (document.getElementById('report-structure')) document.getElementById('report-structure').innerText = structLabel;
            if (document.getElementById('report-structure-name')) document.getElementById('report-structure-name').innerText = structLabel;
            document.getElementById('report-structure-reason').innerText = AppState.reasonForStructure || "ì´ìœ ê°€ ì‘ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";

            // Diagram (Improved capture)
            const canvasClone = document.getElementById('diagram-canvas-final').cloneNode(true);
            // Lock values if they are input/contenteditable
            canvasClone.querySelectorAll('[contenteditable]').forEach(el => {
                el.removeAttribute('contenteditable');
                el.style.border = 'none';
                el.style.background = 'transparent';
            });
            document.getElementById('report-diagram-view').innerHTML = canvasClone.innerHTML;

            // Hide control buttons in report view
            document.querySelectorAll('#report-diagram-view .remove-box-btn, #report-diagram-view .add-box-btn').forEach(el => el.style.display = 'none');

            // Reflection (Capture from textarea)
            AppState.userSummary = document.getElementById('user-summary-input').value.trim();
            document.getElementById('report-user-summary').innerText = AppState.userSummary || "ì‘ì„±ëœ ì†Œê°ì´ ì—†ìŠµë‹ˆë‹¤.";

            // Save to history (if not just viewing a saved one)
            saveToHistory();

            // Recommendations
            populateRecommendations();
        }

        function saveToHistory() {
            try {
                const history = JSON.parse(localStorage.getItem('reading_reports_history') || '[]');
                const reportId = Date.now();
                const newReport = {
                    id: reportId,
                    date: new Date().toLocaleString(),
                    level: document.getElementById('level-badge').innerText || AppState.level,
                    score: AppState.score,
                    title: AppState.currentText.title,
                    structureType: AppState.currentStructureType,
                    reason: AppState.reasonForStructure,
                    summary: AppState.userSummary,
                    diagramItems: AppState.diagramItems,
                    keyword: AppState.currentText.keyword,
                    paragraphs: AppState.currentText.paragraphs,
                    sentences: AppState.currentSentences
                };

                // Avoid duplication (if viewing then saving again, but here showReport is called on finish)
                // For now, just prepend
                history.unshift(newReport);
                localStorage.setItem('reading_reports_history', JSON.stringify(history.slice(0, 20))); // Keep last 20
            } catch (e) { console.error("History save failed", e); }
        }

        function renderHistory() {
            const listContainer = document.getElementById('history-list');
            const emptyContainer = document.getElementById('history-empty');
            if (!listContainer) return;

            const history = JSON.parse(localStorage.getItem('reading_reports_history') || '[]');

            if (history.length === 0) {
                listContainer.style.display = 'none';
                emptyContainer.style.display = 'block';
                return;
            }

            listContainer.style.display = 'grid';
            emptyContainer.style.display = 'none';
            listContainer.innerHTML = history.map(h => `
                <div class="selection-card" onclick="viewSavedReport(${h.id})">
                    <div style="font-size: 1.2rem; margin-bottom: 10px; font-weight: bold; color: var(--primary-dark);">${h.title}</div>
                    <div style="font-size: 0.85rem; color: #64748b; margin-bottom: 10px;">${h.date}</div>
                    <div style="display:flex; justify-content:center; gap:10px;">
                        <span class="badge ${h.level === 'ì´ˆê¸‰' ? 'beginner' : h.level === 'ì¤‘ê¸‰' ? 'intermediate' : 'advanced'}" style="font-size:0.7rem;">${h.level}</span>
                        <span style="font-weight:bold; color:var(--primary); font-size:0.9rem;">${h.score}ì </span>
                    </div>
                </div>
            `).join('');
        }

        function viewSavedReport(id) {
            const history = JSON.parse(localStorage.getItem('reading_reports_history') || '[]');
            const r = history.find(item => item.id == id);
            if (!r) return;

            // Mock AppState for viewing
            AppState.score = r.score;
            AppState.level = r.level;
            AppState.currentText = { title: r.title, keyword: r.keyword, paragraphs: r.paragraphs };
            AppState.currentSentences = r.sentences;
            AppState.currentStructureType = r.structureType;
            AppState.reasonForStructure = r.reason;
            AppState.userSummary = r.summary;
            AppState.diagramItems = r.diagramItems;

            showScreen('screen-report');

            // Re-populate everything (Simplified bypass of saveToHistory to avoid loop)
            document.getElementById('final-score-display').innerText = r.score;
            document.getElementById('report-level-text').innerText = r.level;
            document.getElementById('report-date').innerText = r.date;

            // Text
            document.getElementById('report-text').innerHTML = r.paragraphs.map(p => {
                let pText = p.text;
                if (pText.includes(r.keyword)) {
                    pText = pText.replace(new RegExp(r.keyword, 'g'), `<span style="background-color: #fef08a; font-weight:bold; border-radius: 4px; padding: 2px 4px;">${r.keyword}</span>`);
                }
                return `<p style="text-indent: 1.5rem; margin-bottom: 10px; line-height: 1.6;">${pText}</p>`;
            }).join('');

            const structLabel = r.structureType === 'enum' ? 'ì—´ê±° êµ¬ì¡°' :
                r.structureType === 'seq' ? 'ìˆœì„œ êµ¬ì¡°' : 'ë¹„êµì™€ ëŒ€ì¡°';
            if (document.getElementById('report-structure')) document.getElementById('report-structure').innerText = structLabel;
            if (document.getElementById('report-structure-name')) document.getElementById('report-structure-name').innerText = structLabel;
            document.getElementById('report-structure-reason').innerText = r.reason || "ì´ìœ ê°€ ì‘ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
            document.getElementById('report-user-summary').innerText = r.summary || "ì‘ì„±ëœ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤.";

            // Diagram Re-render (Manual since it depends on AppState)
            renderDiagram(); // This updates diagram-canvas-final

            // Need a slight timeout to clone it from the canvas to the report view
            setTimeout(() => {
                const canvasSource = document.getElementById('diagram-canvas-final');
                const canvasClone = canvasSource.cloneNode(true);
                canvasClone.querySelectorAll('[contenteditable]').forEach(el => {
                    el.removeAttribute('contenteditable');
                    el.style.border = 'none';
                    el.style.background = 'transparent';
                });
                document.getElementById('report-diagram-view').innerHTML = canvasClone.innerHTML;
                document.querySelectorAll('#report-diagram-view .remove-box-btn, #report-diagram-view .add-box-btn').forEach(el => el.style.display = 'none');
            }, 100);

            populateRecommendations();

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function clearHistory() {
            if (confirm("ì €ì¥ëœ ëª¨ë“  ë³´ê³ ì„œ ê¸°ë¡ì„ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ? ğŸ—‘ï¸")) {
                localStorage.removeItem('reading_reports_history');
                renderHistory();
            }
        }

        async function exportReport(format) {
            const paper = document.querySelector('.report-paper');
            if (!paper) return;

            if (format === 'jpg') {
                showFeedback("ë³´ê³ ì„œë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜ ì¤‘ì…ë‹ˆë‹¤... â³", true);

                // Use html2canvas to capture the report paper
                html2canvas(paper, {
                    scale: 2, // Higher resolution
                    useCORS: true,
                    logging: false,
                    backgroundColor: "#ffffff"
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `ë…í•´ë¶„ì„ë³´ê³ ì„œ_${AppState.userKeyword}_${new Date().toLocaleDateString()}.jpg`;
                    link.href = canvas.toDataURL('image/jpeg', 0.9);
                    link.click();
                    showFeedback("ì´ë¯¸ì§€ ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ–¼ï¸", true);
                }).catch(err => {
                    console.error("Capture failed", err);
                    showFeedback("ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ğŸ˜¥", false);
                });
            } else if (format === 'pdf') {
                window.print();
            }
        }

        function populateRecommendations() {
            const container = document.getElementById('report-recommendations');
            if (!container) return;
            container.innerHTML = '';

            const level = AppState.level;
            let recs = [];

            if (level === 'beginner') {
                recs = [
                    { icon: 'ğŸƒ', title: 'ì¤‘ê¸‰ ë ˆë²¨ ë„ì „', desc: 'ë¬¸ë‹¨ì´ ìˆëŠ” ì¡°ê¸ˆ ë” ê¸´ ê¸€ì„ ë¶„ì„í•´ë³´ì„¸ìš”!', action: "startGame('intermediate')" }
                ];
            } else if (level === 'intermediate') {
                recs = [
                    { icon: 'ğŸ§—', title: 'ìƒê¸‰ ë ˆë²¨ ë„ì „', desc: 'ë³µì¡í•œ êµ¬ì¡°ì˜ ê¸´ ê¸€ì„ ì™„ë²½í•˜ê²Œ ë¶„ì„í•´ë³´ì„¸ìš”!', action: "startGame('advanced')" },
                    { icon: 'ğŸ–Œï¸', title: 'ë„í•´ì¡°ì§ì ê·¸ë¦¬ê¸°', desc: 'ì¢…ì´ì— ì˜¤ëŠ˜ ë¶„ì„í•œ êµ¬ì¡°ë¥¼ ì§ì ‘ ê·¸ë ¤ë³´ë©° ë³µìŠµí•˜ì„¸ìš”.', action: null }
                ];
            } else {
                recs = [
                    { icon: 'ğŸ“', title: 'ë¶„ì„ ë§ˆìŠ¤í„° ë„ì „', desc: 'ìƒˆë¡œìš´ ê¸€ì„ ì°¾ì•„ ì§ì ‘ êµ¬ì¡°ë¥¼ ë‚˜ëˆ„ê³  ì¹œêµ¬ì—ê²Œ ì„¤ëª…í•´ë³´ì„¸ìš”.', action: null },
                    { icon: 'ğŸ“', title: 'ê¸€ì“°ê¸° ì‹¬í™”', desc: 'ë¶„ì„í•œ êµ¬ì¡°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‚˜ë§Œì˜ ë©‹ì§„ ì„¤ëª…í•˜ëŠ” ê¸€ì„ ì¨ë³´ì„¸ìš”.', action: "location.reload()" }
                ];
            }

            recs.forEach(r => {
                const card = document.createElement('div');
                card.className = 'recommend-card';
                if (r.action) card.onclick = () => eval(r.action);
                card.innerHTML = `
                    <div class="recommend-icon">${r.icon}</div>
                    <div style="text-align:left;">
                        <div style="font-weight:bold; color:var(--primary-dark);">${r.title}</div>
                        <div style="font-size:0.85rem; color:#64748b; margin-top:2px;">${r.desc}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        /* [UTILS] -------------------------------------------- */
        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }


        // Initialize 
        renderQuiz();

    </script>
</body>

</html>
